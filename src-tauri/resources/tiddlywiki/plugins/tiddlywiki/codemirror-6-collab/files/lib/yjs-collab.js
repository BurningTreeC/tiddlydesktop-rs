/*\
title: $:/plugins/tiddlywiki/codemirror-6-collab/lib/yjs-collab.js
type: application/javascript
module-type: library

Bundled Yjs + y-codemirror.next + y-protocols/awareness
Built with esbuild - DO NOT EDIT DIRECTLY

@license MIT (Yjs), MIT (y-codemirror.next), MIT (y-protocols)
\*/
/*jslint node: true, browser: true */
"use strict";

var Zi=Object.create;var Ie=Object.defineProperty;var Qi=Object.getOwnPropertyDescriptor;var tc=Object.getOwnPropertyNames;var ec=Object.getPrototypeOf,nc=Object.prototype.hasOwnProperty;var rc=(e,t,n)=>t in e?Ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Bs=(e,t)=>{for(var n in t)Ie(e,n,{get:t[n],enumerable:!0})},$s=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of tc(t))!nc.call(e,s)&&s!==n&&Ie(e,s,{get:()=>t[s],enumerable:!(r=Qi(t,s))||r.enumerable});return e};var Dt=(e,t,n)=>(n=e!=null?Zi(ec(e)):{},$s(t||!e||!e.__esModule?Ie(n,"default",{value:e,enumerable:!0}):n,e)),sc=e=>$s(Ie({},"__esModule",{value:!0}),e);var dn=(e,t,n)=>rc(e,typeof t!="symbol"?t+"":t,n);var Qa={};Bs(Qa,{Awareness:()=>wr,Y:()=>At,applyAwarenessUpdate:()=>Wi,encodeAwarenessUpdate:()=>Ki,removeAwarenessStates:()=>Ms,yCollab:()=>Xi,yUndoManagerKeymap:()=>Ls});module.exports=sc(Qa);var At={};Bs(At,{AbsolutePosition:()=>zn,AbstractConnector:()=>os,AbstractStruct:()=>Ee,AbstractType:()=>U,Array:()=>Pt,ContentAny:()=>Ct,ContentBinary:()=>Jt,ContentDeleted:()=>Ue,ContentDoc:()=>Ht,ContentEmbed:()=>mt,ContentFormat:()=>C,ContentJSON:()=>ln,ContentString:()=>et,ContentType:()=>Z,Doc:()=>Et,GC:()=>$,ID:()=>pt,Item:()=>S,Map:()=>Yt,PermanentUserData:()=>cs,RelativePosition:()=>Se,Skip:()=>N,Snapshot:()=>tn,Text:()=>_e,Transaction:()=>Jn,UndoManager:()=>jt,UpdateDecoderV1:()=>z,UpdateDecoderV2:()=>q,UpdateEncoderV1:()=>at,UpdateEncoderV2:()=>H,XmlElement:()=>Gt,XmlFragment:()=>zt,XmlHook:()=>cn,XmlText:()=>tr,YArrayEvent:()=>Kn,YEvent:()=>qt,YMapEvent:()=>Wn,YTextEvent:()=>Zn,YXmlEvent:()=>Qn,applyUpdate:()=>Ll,applyUpdateV2:()=>rr,cleanupYTextFormatting:()=>Mi,compareIDs:()=>Mt,compareRelativePositions:()=>or,convertUpdateFormatV1ToV2:()=>fa,convertUpdateFormatV2ToV1:()=>xi,createAbsolutePositionFromRelativePosition:()=>Ae,createDeleteSet:()=>nr,createDeleteSetFromStructStore:()=>ms,createDocFromSnapshot:()=>Zl,createID:()=>y,createRelativePositionFromJSON:()=>wt,createRelativePositionFromTypeIndex:()=>Ce,createSnapshot:()=>Ss,decodeRelativePosition:()=>zl,decodeSnapshot:()=>Xl,decodeSnapshotV2:()=>ii,decodeStateVector:()=>xs,decodeUpdate:()=>ia,decodeUpdateV2:()=>fi,diffUpdate:()=>ha,diffUpdateV2:()=>_s,emptySnapshot:()=>Kl,encodeRelativePosition:()=>Pl,encodeSnapshot:()=>Hl,encodeSnapshotV2:()=>oi,encodeStateAsUpdate:()=>Ml,encodeStateAsUpdateV2:()=>ni,encodeStateVector:()=>$l,encodeStateVectorFromUpdate:()=>ca,encodeStateVectorFromUpdateV2:()=>gi,equalDeleteSets:()=>ti,equalSnapshots:()=>Jl,findIndexSS:()=>W,findRootTypeKey:()=>ks,getItem:()=>Rt,getItemCleanEnd:()=>hs,getItemCleanStart:()=>B,getState:()=>_,getTypeChildren:()=>wa,isDeleted:()=>Xt,isParentOf:()=>Qe,iterateDeletedStructs:()=>Bt,logType:()=>Fl,logUpdate:()=>oa,logUpdateV2:()=>ui,mergeDeleteSets:()=>$t,mergeUpdates:()=>pi,mergeUpdatesV2:()=>nn,obfuscateUpdate:()=>da,obfuscateUpdateV2:()=>ua,parseUpdateMeta:()=>la,parseUpdateMetaV2:()=>mi,readUpdate:()=>Ol,readUpdateV2:()=>ys,relativePositionToJSON:()=>sr,snapshot:()=>Wl,snapshotContainsUpdate:()=>ta,transact:()=>k,tryGc:()=>ra,typeListToArraySnapshot:()=>ya,typeMapGetAllSnapshot:()=>vi,typeMapGetSnapshot:()=>ka});var E=()=>new Map,un=e=>{let t=E();return e.forEach((n,r)=>{t.set(r,n)}),t},R=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},Fs=(e,t)=>{let n=[];for(let[r,s]of e)n.push(t(s,r));return n},js=(e,t)=>{for(let[n,r]of e)if(t(r,n))return!0;return!1};var nt=()=>new Set;var fn=e=>e[e.length-1];var qs=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Q=Array.from,pn=(e,t)=>{for(let n=0;n<e.length;n++)if(!t(e[n],n,e))return!1;return!0},ve=(e,t)=>{for(let n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1};var Ps=(e,t)=>{let n=new Array(e);for(let r=0;r<e;r++)n[r]=t(r,n);return n};var dt=Array.isArray;var Qt=class{constructor(){this._observers=E()}on(t,n){return R(this._observers,t,nt).add(n),n}once(t,n){let r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){let r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Q((this._observers.get(t)||E()).values()).forEach(r=>r(...n))}destroy(){this._observers=E()}},gn=class{constructor(){this._observers=E()}on(t,n){R(this._observers,t,nt).add(n)}once(t,n){let r=(...s)=>{this.off(t,r),n(...s)};this.on(t,r)}off(t,n){let r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Q((this._observers.get(t)||E()).values()).forEach(r=>r(...n))}destroy(){this._observers=E()}};var L=Math.floor;var It=Math.abs;var te=(e,t)=>e<t?e:t,tt=(e,t)=>e>t?e:t,nh=Number.isNaN;var mn=e=>e!==0?e<0:1/e<0;var ee=Number.MAX_SAFE_INTEGER,xr=Number.MIN_SAFE_INTEGER,rh=1<<31;var Ys=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&L(e)===e),sh=Number.isNaN,oh=Number.parseInt;var kr=String.fromCharCode,oc=String.fromCodePoint,ih=kr(65535),ic=e=>e.toLowerCase(),cc=/^\s*/g,lc=e=>e.replace(cc,""),ac=/([A-Z])/g,Sr=(e,t)=>lc(e.replace(ac,n=>`${t}${ic(n)}`));var hc=e=>{let t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},re=typeof TextEncoder!="undefined"?new TextEncoder:null,dc=e=>re.encode(e),zs=re?dc:hc;var ne=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ne&&ne.decode(new Uint8Array).length===1&&(ne=null);var wn=(e,t)=>Ps(t,()=>e).join("");var vt=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},ut=()=>new vt;var uc=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t};var F=e=>{let t=new Uint8Array(uc(e)),n=0;for(let r=0;r<e.bufs.length;r++){let s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},fc=(e,t)=>{let n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(tt(n,t)*2),e.cpos=0)},T=(e,t)=>{let n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t};var ce=T;var m=(e,t)=>{for(;t>127;)T(e,128|127&t),t=L(t/128);T(e,127&t)},Ne=(e,t)=>{let n=mn(t);for(n&&(t=-t),T(e,(t>63?128:0)|(n?64:0)|63&t),t=L(t/64);t>0;)T(e,(t>127?128:0)|127&t),t=L(t/128)},_r=new Uint8Array(3e4),pc=_r.length/3,gc=(e,t)=>{if(t.length<pc){let n=re.encodeInto(t,_r).written||0;m(e,n);for(let r=0;r<n;r++)T(e,_r[r])}else P(e,zs(t))},mc=(e,t)=>{let n=unescape(encodeURIComponent(t)),r=n.length;m(e,r);for(let s=0;s<r;s++)T(e,n.codePointAt(s))},rt=re&&re.encodeInto?gc:mc;var Ks=(e,t)=>le(e,F(t)),le=(e,t)=>{let n=e.cbuf.length,r=e.cpos,s=te(n-r,t.length),o=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(tt(n*2,o)),e.cbuf.set(t.subarray(s)),e.cpos=o)},P=(e,t)=>{m(e,t.byteLength),le(e,t)},Er=(e,t)=>{fc(e,t);let n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},wc=(e,t)=>Er(e,4).setFloat32(0,t,!1),yc=(e,t)=>Er(e,8).setFloat64(0,t,!1),xc=(e,t)=>Er(e,8).setBigInt64(0,t,!1);var Js=new DataView(new ArrayBuffer(4)),bc=e=>(Js.setFloat32(0,e),Js.getFloat32(0)===e),oe=(e,t)=>{switch(typeof t){case"string":T(e,119),rt(e,t);break;case"number":Ys(t)&&It(t)<=2147483647?(T(e,125),Ne(e,t)):bc(t)?(T(e,124),wc(e,t)):(T(e,123),yc(e,t));break;case"bigint":T(e,122),xc(e,t);break;case"object":if(t===null)T(e,126);else if(dt(t)){T(e,117),m(e,t.length);for(let n=0;n<t.length;n++)oe(e,t[n])}else if(t instanceof Uint8Array)T(e,116),P(e,t);else{T(e,118);let n=Object.keys(t);m(e,n.length);for(let r=0;r<n.length;r++){let s=n[r];rt(e,s),oe(e,t[s])}}break;case"boolean":T(e,t?120:121);break;default:T(e,127)}},Le=class extends vt{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&m(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}};var Hs=e=>{e.count>0&&(Ne(e.encoder,e.count===1?e.s:-e.s),e.count>1&&m(e.encoder,e.count-2))},Vt=class{constructor(){this.encoder=new vt,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Hs(this),this.count=1,this.s=t)}toUint8Array(){return Hs(this),F(this.encoder)}};var Xs=e=>{if(e.count>0){let t=e.diff*2+(e.count===1?0:1);Ne(e.encoder,t),e.count>1&&m(e.encoder,e.count-2)}},ie=class{constructor(){this.encoder=new vt,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Xs(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Xs(this),F(this.encoder)}},yn=class{constructor(){this.sarr=[],this.s="",this.lensE=new Vt}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){let t=new vt;return this.sarr.push(this.s),this.s="",rt(t,this.sarr.join("")),le(t,this.lensE.toUint8Array()),F(t)}};var G=e=>new Error(e),J=()=>{throw G("Method unimplemented")},v=()=>{throw G("Unexpected case")};var Zs=G("Unexpected end of array"),Qs=G("Integer out of Range"),ae=class{constructor(t){this.arr=t,this.pos=0}},D=e=>new ae(e),Cr=e=>e.pos!==e.arr.length;var kc=(e,t)=>{let n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Y=e=>kc(e,w(e));var Ot=e=>e.arr[e.pos++];var w=e=>{let t=0,n=1,r=e.arr.length;for(;e.pos<r;){let s=e.arr[e.pos++];if(t=t+(s&127)*n,n*=128,s<128)return t;if(t>ee)throw Qs}throw Zs},Re=e=>{let t=e.arr[e.pos++],n=t&63,r=64,s=(t&64)>0?-1:1;if((t&128)===0)return s*n;let o=e.arr.length;for(;e.pos<o;){if(t=e.arr[e.pos++],n=n+(t&127)*r,r*=128,t<128)return s*n;if(n>ee)throw Qs}throw Zs};var Sc=e=>{let t=w(e);if(t===0)return"";{let n=String.fromCodePoint(Ot(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Ot(e));else for(;t>0;){let r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},_c=e=>ne.decode(Y(e)),st=ne?_c:Sc;var Ar=(e,t)=>{let n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Ec=e=>Ar(e,4).getFloat32(0,!1),Uc=e=>Ar(e,8).getFloat64(0,!1),Cc=e=>Ar(e,8).getBigInt64(0,!1);var Ac=[e=>{},e=>null,Re,Ec,Uc,Cc,e=>!1,e=>!0,st,e=>{let t=w(e),n={};for(let r=0;r<t;r++){let s=st(e);n[s]=he(e)}return n},e=>{let t=w(e),n=[];for(let r=0;r<t;r++)n.push(he(e));return n},Y],he=e=>Ac[127-Ot(e)](e),Me=class extends ae{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Cr(this)?this.count=w(this)+1:this.count=-1),this.count--,this.s}};var Lt=class extends ae{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=Re(this);let t=mn(this.s);this.count=1,t&&(this.s=-this.s,this.count=w(this)+2)}return this.count--,this.s}};var de=class extends ae{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let t=Re(this),n=t&1;this.diff=L(t/2),this.count=1,n&&(this.count=w(this)+2)}return this.s+=this.diff,this.count--,this.s}},xn=class{constructor(t){this.decoder=new Lt(t),this.str=st(this.decoder),this.spos=0}read(){let t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}};var ah=crypto.subtle,eo=crypto.getRandomValues.bind(crypto);var Dr=()=>eo(new Uint32Array(1))[0];var Dc="10000000-1000-4000-8000"+-1e11,no=()=>Dc.replace(/[018]/g,e=>(e^Dr()&15>>e/4).toString(16));var ft=Date.now;var Tr=e=>new Promise(e);var uh=Promise.all.bind(Promise);var vr=e=>e===void 0?null:e;var Vr=class{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}},ro=new Vr,Vc=!0;try{typeof localStorage!="undefined"&&localStorage&&(ro=localStorage,Vc=!1)}catch(e){}var so=ro;var Nt=Symbol("Equality"),bn=(e,t)=>{var n;return e===t||!!((n=e==null?void 0:e[Nt])!=null&&n.call(e,t))||!1};var oo=e=>typeof e=="object",io=Object.assign,Lc=Object.keys;var co=(e,t)=>{for(let n in e)t(e[n],n)};var Be=e=>Lc(e).length;var lo=e=>{for(let t in e)return!1;return!0},ue=(e,t)=>{for(let n in e)if(!t(e[n],n))return!1;return!0},$e=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Lr=(e,t)=>e===t||Be(e)===Be(t)&&ue(e,(n,r)=>(n!==void 0||$e(t,r))&&bn(t[r],n)),Nc=Object.freeze,Nr=e=>{for(let t in e){let n=e[t];(typeof n=="object"||typeof n=="function")&&Nr(e[t])}return Nc(e)};var Fe=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Fe(e,t,n+1)}};var Rr=e=>e;var xt=(e,t)=>{if(e===t)return!0;if(e==null||t==null||e.constructor!==t.constructor&&(e.constructor||Object)!==(t.constructor||Object))return!1;if(e[Nt]!=null)return e[Nt](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(let n of e.keys())if(!t.has(n)||!xt(e.get(n),t.get(n)))return!1;break}case void 0:case Object:if(Be(e)!==Be(t))return!1;for(let n in e)if(!$e(e,n)||!xt(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!xt(e[n],t[n]))return!1;break;default:return!1}return!0},ao=(e,t)=>t.includes(e);var je=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var fh=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,ot,Mc=[],Rc=()=>{if(ot===void 0)if(je){ot=E();let e=process.argv,t=null;for(let n=0;n<e.length;n++){let r=e[n];r[0]==="-"?(t!==null&&ot.set(t,""),t=r):t!==null?(ot.set(t,r),t=null):Mc.push(r)}t!==null&&ot.set(t,"")}else typeof location=="object"?(ot=E(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){let[t,n]=e.split("=");ot.set(`--${Sr(t,"-")}`,n),ot.set(`-${Sr(t,"-")}`,n)}})):ot=E();return ot},Br=e=>Rc().has(e);var qe=e=>je?vr(process.env[e.toUpperCase().replaceAll("-","_")]):vr(so.getItem(e));var ho=e=>Br("--"+e)||qe(e)!==null,uo=ho("production"),Bc=je&&ao(process.env.FORCE_COLOR,["true","1","2"]),fo=Bc||!Br("--no-colors")&&!ho("no-color")&&(!je||process.stdout.isTTY)&&(!je||Br("--color")||qe("COLORTERM")!==null||(qe("TERM")||"").includes("color"));var $c=e=>new Uint8Array(e);var po=e=>{let t=$c(e.byteLength);return t.set(e),t};var Fr=class{constructor(t,n){this.left=t,this.right=n}},j=(e,t)=>new Fr(e,t);var go=(e,t)=>e.forEach(n=>t(n.left,n.right));var qr=e=>e.next()>=.5,Sn=(e,t,n)=>L(e.next()*(n+1-t)+t);var Pr=(e,t,n)=>L(e.next()*(n+1-t)+t);var Yr=(e,t,n)=>Pr(e,t,n);var jc=e=>kr(Yr(e,97,122)),mo=(e,t=0,n=20)=>{let r=Yr(e,t,n),s="";for(let o=0;o<r;o++)s+=jc(e);return s};var _n=(e,t)=>t[Yr(e,0,t.length-1)];var Pc=Symbol("0schema"),zr=class{constructor(){this._rerrs=[]}extend(t,n,r,s=null){this._rerrs.push({path:t,expected:n,has:r,message:s})}toString(){let t=[];for(let n=this._rerrs.length-1;n>0;n--){let r=this._rerrs[n];t.push(wn(" ",(this._rerrs.length-n)*2)+`${r.path!=null?`[${r.path}] `:""}${r.has} doesn't match ${r.expected}. ${r.message}`)}return t.join(`
`)}},Gr=(e,t)=>e===t?!0:e==null||t==null||e.constructor!==t.constructor?!1:e[Nt]?bn(e,t):dt(e)?pn(e,n=>ve(t,r=>Gr(n,r))):oo(e)?ue(e,(n,r)=>Gr(n,t[r])):!1,V=class{extends(t){let[n,r]=[this.shape,t.shape];return this.constructor._dilutes&&([r,n]=[n,r]),Gr(n,r)}equals(t){return this.constructor===t.constructor&&xt(this.shape,t.shape)}[Pc](){return!0}[Nt](t){return this.equals(t)}validate(t){return this.check(t)}check(t,n){J()}get nullable(){return ye(this,Mn)}get optional(){return new En(this)}cast(t){return wo(t,this),t}expect(t){return wo(t,this),t}};dn(V,"_dilutes",!1);var Pe=class extends V{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n=void 0){let r=(t==null?void 0:t.constructor)===this.shape&&(this._c==null||this._c(t));return!r&&(n==null||n.extend(null,this.shape.name,t==null?void 0:t.constructor.name,(t==null?void 0:t.constructor)!==this.shape?"Constructor match failed":"Check failed")),r}},A=(e,t=null)=>new Pe(e,t),gh=A(Pe),Ye=class extends V{constructor(t){super(),this.shape=t}check(t,n){let r=this.shape(t);return!r&&(n==null||n.extend(null,"custom prop",t==null?void 0:t.constructor.name,"failed to check custom prop")),r}},I=e=>new Ye(e),mh=A(Ye),me=class extends V{constructor(t){super(),this.shape=t}check(t,n){let r=this.shape.some(s=>s===t);return!r&&(n==null||n.extend(null,this.shape.join(" | "),t.toString())),r}},Ln=(...e)=>new me(e),yo=A(me),Yc=RegExp.escape||(e=>e.replace(/[().|&,$^[\]]/g,t=>"\\"+t)),xo=e=>{if(we.check(e))return[Yc(e)];if(yo.check(e))return e.shape.map(t=>t+"");if(Eo.check(e))return["[+-]?\\d+.?\\d*"];if(Uo.check(e))return[".*"];if(vn.check(e))return e.shape.map(xo).flat(1);v()},Jr=class extends V{constructor(t){super(),this.shape=t,this._r=new RegExp("^"+t.map(xo).map(n=>`(${n.join("|")})`).join("")+"$")}check(t,n){let r=this._r.exec(t)!=null;return!r&&(n==null||n.extend(null,this._r.toString(),t.toString(),"String doesn't match string template.")),r}};var wh=A(Jr),zc=Symbol("optional"),En=class extends V{constructor(t){super(),this.shape=t}check(t,n){let r=t===void 0||this.shape.check(t);return!r&&(n==null||n.extend(null,"undefined (optional)","()")),r}get[zc](){return!0}},Gc=A(En),Un=class extends V{check(t,n){return n==null||n.extend(null,"never",typeof t),!1}},yh=new Un,xh=A(Un),On=class On extends V{constructor(t,n=!1){super(),this.shape=t,this._isPartial=n}get partial(){return new On(this.shape,!0)}check(t,n){return t==null?(n==null||n.extend(null,"object","null"),!1):ue(this.shape,(r,s)=>{let o=this._isPartial&&!$e(t,s)||r.check(t[s],n);return!o&&(n==null||n.extend(s.toString(),r.toString(),typeof t[s],"Object property does not match")),o})}};dn(On,"_dilutes",!0);var Cn=On,Jc=e=>new Cn(e),Hc=A(Cn),Xc=I(e=>e!=null&&(e.constructor===Object||e.constructor==null)),An=class extends V{constructor(t,n){super(),this.shape={keys:t,values:n}}check(t,n){return t!=null&&ue(t,(r,s)=>{let o=this.shape.keys.check(s,n);return!o&&(n==null||n.extend(s+"","Record",typeof t,o?"Key doesn't match schema":"Value doesn't match value")),o&&this.shape.values.check(r,n)})}},bo=(e,t)=>new An(e,t),Kc=A(An),Dn=class extends V{constructor(t){super(),this.shape=t}check(t,n){return t!=null&&ue(this.shape,(r,s)=>{let o=r.check(t[s],n);return!o&&(n==null||n.extend(s.toString(),"Tuple",typeof r)),o})}},Wc=(...e)=>new Dn(e),bh=A(Dn),In=class extends V{constructor(t){super(),this.shape=t.length===1?t[0]:new pe(t)}check(t,n){let r=dt(t)&&pn(t,s=>this.shape.check(s));return!r&&(n==null||n.extend(null,"Array","")),r}},ko=(...e)=>new In(e),Zc=A(In),Qc=I(e=>dt(e)),Tn=class extends V{constructor(t,n){super(),this.shape=t,this._c=n}check(t,n){let r=t instanceof this.shape&&(this._c==null||this._c(t));return!r&&(n==null||n.extend(null,this.shape.name,t==null?void 0:t.constructor.name)),r}},tl=(e,t=null)=>new Tn(e,t),kh=A(Tn),el=tl(V),Hr=class extends V{constructor(t){super(),this.len=t.length-1,this.args=Wc(...t.slice(-1)),this.res=t[this.len]}check(t,n){let r=t.constructor===Function&&t.length<=this.len;return!r&&(n==null||n.extend(null,"function",typeof t)),r}};var nl=A(Hr),rl=I(e=>typeof e=="function"),Xr=class extends V{constructor(t){super(),this.shape=t}check(t,n){let r=pn(this.shape,s=>s.check(t,n));return!r&&(n==null||n.extend(null,"Intersectinon",typeof t)),r}};var Sh=A(Xr,e=>e.shape.length>0),pe=class extends V{constructor(t){super(),this.shape=t}check(t,n){let r=ve(this.shape,s=>s.check(t,n));return n==null||n.extend(null,"Union",typeof t),r}};dn(pe,"_dilutes",!0);var ye=(...e)=>e.findIndex(t=>vn.check(t))>=0?ye(...e.map(t=>ze(t)).map(t=>vn.check(t)?t.shape:[t]).flat(1)):e.length===1?e[0]:new pe(e),vn=A(pe),So=()=>!0,Vn=I(So),sl=A(Ye,e=>e.shape===So),Wr=I(e=>typeof e=="bigint"),ol=I(e=>e===Wr),_o=I(e=>typeof e=="symbol"),_h=I(e=>e===_o),ge=I(e=>typeof e=="number"),Eo=I(e=>e===ge),we=I(e=>typeof e=="string"),Uo=I(e=>e===we),Nn=I(e=>typeof e=="boolean"),il=I(e=>e===Nn),Co=Ln(void 0),Eh=A(me,e=>e.shape.length===1&&e.shape[0]===void 0),Uh=Ln(void 0);var Mn=Ln(null),cl=A(me,e=>e.shape.length===1&&e.shape[0]===null),Ch=A(Uint8Array),Ah=A(Pe,e=>e.shape===Uint8Array),ll=ye(ge,we,Mn,Co,Wr,Nn,_o),Dh=(()=>{let e=ko(Vn),t=bo(we,Vn),n=ye(ge,we,Mn,Nn,e,t);return e.shape=n,t.shape.values=n,n})(),ze=e=>{if(el.check(e))return e;if(Xc.check(e)){let t={};for(let n in e)t[n]=ze(e[n]);return Jc(t)}else{if(Qc.check(e))return ye(...e.map(ze));if(ll.check(e))return Ln(e);if(rl.check(e))return A(e)}v()},wo=uo?()=>{}:(e,t)=>{let n=new zr;if(!t.check(e,n))throw G(`Expected value to be of type ${t.constructor.name}.
${n.toString()}`)},Kr=class{constructor(t){this.patterns=[],this.$state=t}if(t,n){return this.patterns.push({if:ze(t),h:n}),this}else(t){return this.if(Vn,t)}done(){return(t,n)=>{for(let r=0;r<this.patterns.length;r++){let s=this.patterns[r];if(s.if.check(t))return s.h(t,n)}throw G("Unhandled pattern")}}},al=e=>new Kr(e),Ao=al(Vn).if(Eo,(e,t)=>Sn(t,xr,ee)).if(Uo,(e,t)=>mo(t)).if(il,(e,t)=>qr(t)).if(ol,(e,t)=>BigInt(Sn(t,xr,ee))).if(vn,(e,t)=>fe(t,_n(t,e.shape))).if(Hc,(e,t)=>{let n={};for(let r in e.shape){let s=e.shape[r];if(Gc.check(s)){if(qr(t))continue;s=s.shape}n[r]=Ao(s,t)}return n}).if(Zc,(e,t)=>{let n=[],r=Pr(t,0,42);for(let s=0;s<r;s++)n.push(fe(t,e.shape));return n}).if(yo,(e,t)=>_n(t,e.shape)).if(cl,(e,t)=>null).if(nl,(e,t)=>{let n=fe(t,e.res);return()=>n}).if(sl,(e,t)=>fe(t,_n(t,[ge,we,Mn,Co,Wr,Nn,ko(ge),bo(ye("a","b","c"),ge)]))).if(Kc,(e,t)=>{let n={},r=Sn(t,0,3);for(let s=0;s<r;s++){let o=fe(t,e.shape.keys),i=fe(t,e.shape.values);n[o]=i}return n}).done(),fe=(e,t)=>Ao(ze(t),e);var it=typeof document!="undefined"?document:{},dl=e=>it.createElement(e),ul=()=>it.createDocumentFragment(),Th=I(e=>e.nodeType===xl),fl=e=>it.createTextNode(e),vh=typeof DOMParser!="undefined"?new DOMParser:null;var pl=(e,t)=>(go(t,(n,r)=>{r===!1?e.removeAttribute(n):r===!0?e.setAttribute(n,""):e.setAttribute(n,r)}),e);var gl=e=>{let t=ul();for(let n=0;n<e.length;n++)To(t,e[n]);return t},Do=(e,t)=>(To(e,gl(t)),e);var Ge=(e,t=[],n=[])=>Do(pl(dl(e),t),n),Vh=I(e=>e.nodeType===ml);var xe=fl,Oh=I(e=>e.nodeType===wl);var Io=e=>Fs(e,(t,n)=>`${n}:${t};`).join("");var To=(e,t)=>e.appendChild(t),ml=it.ELEMENT_NODE,wl=it.TEXT_NODE,Lh=it.CDATA_SECTION_NODE,Nh=it.COMMENT_NODE,yl=it.DOCUMENT_NODE,Mh=it.DOCUMENT_TYPE_NODE,xl=it.DOCUMENT_FRAGMENT_NODE,Rh=I(e=>e.nodeType===yl);var ct=Symbol;var Je=ct(),He=ct(),Zr=ct(),Qr=ct(),ts=ct(),Xe=ct(),es=ct(),be=ct(),ns=ct(),Vo=e=>{var s;e.length===1&&((s=e[0])==null?void 0:s.constructor)===Function&&(e=e[0]());let t=[],n=[],r=0;for(;r<e.length;r++){let o=e[r];if(o===void 0)break;if(o.constructor===String||o.constructor===Number)t.push(o);else if(o.constructor===Object)break}for(r>0&&n.push(t.join(""));r<e.length;r++){let o=e[r];o instanceof Symbol||n.push(o)}return n};var Bh=ft();var Sl={[Je]:j("font-weight","bold"),[He]:j("font-weight","normal"),[Zr]:j("color","blue"),[ts]:j("color","green"),[Qr]:j("color","grey"),[Xe]:j("color","red"),[es]:j("color","purple"),[be]:j("color","orange"),[ns]:j("color","black")},_l=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());let t=[],n=[],r=E(),s=[],o=0;for(;o<e.length;o++){let c=e[o],l=Sl[c];if(l!==void 0)r.set(l.left,l.right);else{if(c===void 0)break;if(c.constructor===String||c.constructor===Number){let a=Io(r);o>0||a.length>0?(t.push("%c"+c),n.push(a)):t.push(c)}else break}}for(o>0&&(s=n,s.unshift(t.join("")));o<e.length;o++){let c=e[o];c instanceof Symbol||s.push(c)}return s},Oo=fo?_l:Vo,Rn=(...e)=>{console.log(...Oo(e)),Lo.forEach(t=>t.print(e))},rs=(...e)=>{console.warn(...Oo(e)),e.unshift(be),Lo.forEach(t=>t.print(e))};var Lo=nt();var No=e=>({[Symbol.iterator](){return this},next:e}),Mo=(e,t)=>No(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Bn=(e,t)=>No(()=>{let{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});var os=class extends Qt{constructor(t,n){super(),this.doc=t,this.awareness=n}},We=class{constructor(t,n){this.clock=t,this.len=n}},_t=class{constructor(){this.clients=new Map}},Bt=(e,t,n)=>t.clients.forEach((r,s)=>{let o=e.doc.store.clients.get(s);if(o!=null){let i=o[o.length-1],c=i.id.clock+i.length;for(let l=0,a=r[l];l<r.length&&a.clock<c;a=r[++l])li(e,o,a.clock,a.len,n)}}),Dl=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){let s=L((n+r)/2),o=e[s],i=o.clock;if(i<=t){if(t<i+o.len)return s;n=s+1}else r=s-1}return null},Xt=(e,t)=>{let n=e.clients.get(t.client);return n!==void 0&&Dl(n,t.clock)!==null},gs=e=>{e.clients.forEach(t=>{t.sort((s,o)=>s.clock-o.clock);let n,r;for(n=1,r=1;n<t.length;n++){let s=t[r-1],o=t[n];s.clock+s.len>=o.clock?s.len=tt(s.len,o.clock+o.len-s.clock):(r<n&&(t[r]=o),r++)}t.length=r})},$t=e=>{let t=new _t;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,s)=>{if(!t.clients.has(s)){let o=r.slice();for(let i=n+1;i<e.length;i++)qs(o,e[i].clients.get(s)||[]);t.clients.set(s,o)}});return gs(t),t},Ze=(e,t,n,r)=>{R(e.clients,t,()=>[]).push(new We(n,r))},nr=()=>new _t,ms=e=>{let t=nr();return e.clients.forEach((n,r)=>{let s=[];for(let o=0;o<n.length;o++){let i=n[o];if(i.deleted){let c=i.id.clock,l=i.length;if(o+1<n.length)for(let a=n[o+1];o+1<n.length&&a.deleted;a=n[++o+1])l+=a.length;s.push(new We(c,l))}}s.length>0&&t.clients.set(r,s)}),t},lt=(e,t)=>{m(e.restEncoder,t.clients.size),Q(t.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{e.resetDsCurVal(),m(e.restEncoder,n);let s=r.length;m(e.restEncoder,s);for(let o=0;o<s;o++){let i=r[o];e.writeDsClock(i.clock),e.writeDsLen(i.len)}})},gt=e=>{let t=new _t,n=w(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();let s=w(e.restDecoder),o=w(e.restDecoder);if(o>0){let i=R(t.clients,s,()=>[]);for(let c=0;c<o;c++)i.push(new We(e.readDsClock(),e.readDsLen()))}}return t},$o=(e,t,n)=>{let r=new _t,s=w(e.restDecoder);for(let o=0;o<s;o++){e.resetDsCurVal();let i=w(e.restDecoder),c=w(e.restDecoder),l=n.clients.get(i)||[],a=_(n,i);for(let h=0;h<c;h++){let d=e.readDsClock(),u=d+e.readDsLen();if(d<a){a<u&&Ze(r,i,a,u-a);let f=W(l,d),p=l[f];for(!p.deleted&&p.id.clock<d&&(l.splice(f+1,0,er(t,p,d-p.id.clock)),f++);f<l.length&&(p=l[f++],p.id.clock<u);)p.deleted||(u<p.id.clock+p.length&&l.splice(f,0,er(t,p,u-p.id.clock)),p.delete(t))}else Ze(r,i,d,u-d)}}if(r.clients.size>0){let o=new H;return m(o.restEncoder,0),lt(o,r),o.toUint8Array()}return null},ti=(e,t)=>{if(e.clients.size!==t.clients.size)return!1;for(let[n,r]of e.clients.entries()){let s=t.clients.get(n);if(s===void 0||r.length!==s.length)return!1;for(let o=0;o<r.length;o++){let i=r[o],c=s[o];if(i.clock!==c.clock||i.len!==c.len)return!1}}return!0},ei=Dr,Et=class e extends Qt{constructor({guid:t=no(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:o=null,autoLoad:i=!1,shouldLoad:c=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=ei(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Gn,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=c,this.autoLoad=i,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=Tr(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})});let l=()=>Tr(a=>{let h=d=>{(d===void 0||d===!0)&&(this.off("sync",h),a())};this.on("sync",h)});this.on("sync",a=>{a===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=a===void 0||a===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let t=this._item;t!==null&&!this.shouldLoad&&k(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Q(this.subdocs).map(t=>t.guid))}transact(t,n=null){return k(this,t,n)}get(t,n=U){let r=R(this.share,t,()=>{let o=new n;return o._integrate(this,null),o}),s=r.constructor;if(n!==U&&s!==n)if(s===U){let o=new n;o._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=o}),o._start=r._start;for(let i=o._start;i!==null;i=i.right)i.parent=o;return o._length=r._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Pt)}getText(t=""){return this.get(t,_e)}getMap(t=""){return this.get(t,Yt)}getXmlElement(t=""){return this.get(t,Gt)}getXmlFragment(t=""){return this.get(t,zt)}toJSON(){let t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,Q(this.subdocs).forEach(n=>n.destroy());let t=this._item;if(t!==null){this._item=null;let n=t.content;n.doc=new e({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,k(t.parent.doc,r=>{let s=n.doc;t.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},Ft=class{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return w(this.restDecoder)}readDsLen(){return w(this.restDecoder)}},z=class extends Ft{readLeftID(){return y(w(this.restDecoder),w(this.restDecoder))}readRightID(){return y(w(this.restDecoder),w(this.restDecoder))}readClient(){return w(this.restDecoder)}readInfo(){return Ot(this.restDecoder)}readString(){return st(this.restDecoder)}readParentInfo(){return w(this.restDecoder)===1}readTypeRef(){return w(this.restDecoder)}readLen(){return w(this.restDecoder)}readAny(){return he(this.restDecoder)}readBuf(){return po(Y(this.restDecoder))}readJSON(){return JSON.parse(st(this.restDecoder))}readKey(){return st(this.restDecoder)}},Yn=class{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=w(this.restDecoder),this.dsCurrVal}readDsLen(){let t=w(this.restDecoder)+1;return this.dsCurrVal+=t,t}},q=class extends Yn{constructor(t){super(t),this.keys=[],w(t),this.keyClockDecoder=new de(Y(t)),this.clientDecoder=new Lt(Y(t)),this.leftClockDecoder=new de(Y(t)),this.rightClockDecoder=new de(Y(t)),this.infoDecoder=new Me(Y(t),Ot),this.stringDecoder=new xn(Y(t)),this.parentInfoDecoder=new Me(Y(t),Ot),this.typeRefDecoder=new Lt(Y(t)),this.lenDecoder=new Lt(Y(t))}readLeftID(){return new pt(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new pt(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return he(this.restDecoder)}readBuf(){return Y(this.restDecoder)}readJSON(){return he(this.restDecoder)}readKey(){let t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{let n=this.stringDecoder.read();return this.keys.push(n),n}}},Ut=class{constructor(){this.restEncoder=ut()}toUint8Array(){return F(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){m(this.restEncoder,t)}writeDsLen(t){m(this.restEncoder,t)}},at=class extends Ut{writeLeftID(t){m(this.restEncoder,t.client),m(this.restEncoder,t.clock)}writeRightID(t){m(this.restEncoder,t.client),m(this.restEncoder,t.clock)}writeClient(t){m(this.restEncoder,t)}writeInfo(t){ce(this.restEncoder,t)}writeString(t){rt(this.restEncoder,t)}writeParentInfo(t){m(this.restEncoder,t?1:0)}writeTypeRef(t){m(this.restEncoder,t)}writeLen(t){m(this.restEncoder,t)}writeAny(t){oe(this.restEncoder,t)}writeBuf(t){P(this.restEncoder,t)}writeJSON(t){rt(this.restEncoder,JSON.stringify(t))}writeKey(t){rt(this.restEncoder,t)}},ke=class{constructor(){this.restEncoder=ut(),this.dsCurrVal=0}toUint8Array(){return F(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){let n=t-this.dsCurrVal;this.dsCurrVal=t,m(this.restEncoder,n)}writeDsLen(t){t===0&&v(),m(this.restEncoder,t-1),this.dsCurrVal+=t}},H=class extends ke{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ie,this.clientEncoder=new Vt,this.leftClockEncoder=new ie,this.rightClockEncoder=new ie,this.infoEncoder=new Le(ce),this.stringEncoder=new yn,this.parentInfoEncoder=new Le(ce),this.typeRefEncoder=new Vt,this.lenEncoder=new Vt}toUint8Array(){let t=ut();return m(t,0),P(t,this.keyClockEncoder.toUint8Array()),P(t,this.clientEncoder.toUint8Array()),P(t,this.leftClockEncoder.toUint8Array()),P(t,this.rightClockEncoder.toUint8Array()),P(t,F(this.infoEncoder)),P(t,this.stringEncoder.toUint8Array()),P(t,F(this.parentInfoEncoder)),P(t,this.typeRefEncoder.toUint8Array()),P(t,this.lenEncoder.toUint8Array()),le(t,F(this.restEncoder)),F(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){oe(this.restEncoder,t)}writeBuf(t){P(this.restEncoder,t)}writeJSON(t){oe(this.restEncoder,t)}writeKey(t){let n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}},Il=(e,t,n,r)=>{r=tt(r,t[0].id.clock);let s=W(t,r);m(e.restEncoder,t.length-s),e.writeClient(n),m(e.restEncoder,r);let o=t[s];o.write(e,r-o.id.clock);for(let i=s+1;i<t.length;i++)t[i].write(e,0)},ws=(e,t,n)=>{let r=new Map;n.forEach((s,o)=>{_(t,o)>s&&r.set(o,s)}),an(t).forEach((s,o)=>{n.has(o)||r.set(o,0)}),m(e.restEncoder,r.size),Q(r.entries()).sort((s,o)=>o[0]-s[0]).forEach(([s,o])=>{Il(e,t.clients.get(s),s,o)})},Tl=(e,t)=>{let n=E(),r=w(e.restDecoder);for(let s=0;s<r;s++){let o=w(e.restDecoder),i=new Array(o),c=e.readClient(),l=w(e.restDecoder);n.set(c,{i:0,refs:i});for(let a=0;a<o;a++){let h=e.readInfo();switch(31&h){case 0:{let d=e.readLen();i[a]=new $(y(c,l),d),l+=d;break}case 10:{let d=w(e.restDecoder);i[a]=new N(y(c,l),d),l+=d;break}default:{let d=(h&192)===0,u=new S(y(c,l),null,(h&128)===128?e.readLeftID():null,null,(h&64)===64?e.readRightID():null,d?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,d&&(h&32)===32?e.readString():null,$i(e,h));i[a]=u,l+=u.length}}}}return n},vl=(e,t,n)=>{let r=[],s=Q(n.keys()).sort((f,p)=>f-p);if(s.length===0)return null;let o=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f},i=o();if(i===null)return null;let c=new Gn,l=new Map,a=(f,p)=>{let b=l.get(f);(b==null||b>p)&&l.set(f,p)},h=i.refs[i.i++],d=new Map,u=()=>{for(let f of r){let p=f.id.client,b=n.get(p);b?(b.i--,c.clients.set(p,b.refs.slice(b.i)),n.delete(p),b.i=0,b.refs=[]):c.clients.set(p,[f]),s=s.filter(g=>g!==p)}r.length=0};for(;;){if(h.constructor!==N){let p=R(d,h.id.client,()=>_(t,h.id.client))-h.id.clock;if(p<0)r.push(h),a(h.id.client,h.id.clock-1),u();else{let b=h.getMissing(e,t);if(b!==null){r.push(h);let g=n.get(b)||{refs:[],i:0};if(g.refs.length===g.i)a(b,_(t,b)),u();else{h=g.refs[g.i++];continue}}else(p===0||p<h.length)&&(h.integrate(e,p),d.set(h.id.client,h.id.clock+h.length))}}if(r.length>0)h=r.pop();else if(i!==null&&i.i<i.refs.length)h=i.refs[i.i++];else{if(i=o(),i===null)break;h=i.refs[i.i++]}}if(c.clients.size>0){let f=new H;return ws(f,c,new Map),m(f.restEncoder,0),{missing:l,update:f.toUint8Array()}}return null},Vl=(e,t)=>ws(e,t.doc.store,t.beforeState),ys=(e,t,n,r=new q(e))=>k(t,s=>{s.local=!1;let o=!1,i=s.doc,c=i.store,l=Tl(r,i),a=vl(s,c,l),h=c.pendingStructs;if(h){for(let[u,f]of h.missing)if(f<_(c,u)){o=!0;break}if(a){for(let[u,f]of a.missing){let p=h.missing.get(u);(p==null||p>f)&&h.missing.set(u,f)}h.update=nn([h.update,a.update])}}else c.pendingStructs=a;let d=$o(r,s,c);if(c.pendingDs){let u=new q(D(c.pendingDs));w(u.restDecoder);let f=$o(u,s,c);d&&f?c.pendingDs=nn([d,f]):c.pendingDs=d||f}else c.pendingDs=d;if(o){let u=c.pendingStructs.update;c.pendingStructs=null,rr(s.doc,u)}},n,!1),Ol=(e,t,n)=>ys(e,t,n,new z(e)),rr=(e,t,n,r=q)=>{let s=D(t);ys(s,e,n,new r(s))},Ll=(e,t,n)=>rr(e,t,n,z),Nl=(e,t,n=new Map)=>{ws(e,t.store,n),lt(e,ms(t.store))},ni=(e,t=new Uint8Array([0]),n=new H)=>{let r=xs(t);Nl(n,e,r);let s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(_s(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===at)return pi(s.map((o,i)=>i===0?o:xi(o)));if(n.constructor===H)return nn(s)}return s[0]},Ml=(e,t)=>ni(e,t,new at),ri=e=>{let t=new Map,n=w(e.restDecoder);for(let r=0;r<n;r++){let s=w(e.restDecoder),o=w(e.restDecoder);t.set(s,o)}return t},xs=e=>ri(new Ft(D(e))),bs=(e,t)=>(m(e.restEncoder,t.size),Q(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{m(e.restEncoder,n),m(e.restEncoder,r)}),e),Rl=(e,t)=>bs(e,an(t.store)),Bl=(e,t=new ke)=>(e instanceof Map?bs(t,e):Rl(t,e),t.toUint8Array()),$l=e=>Bl(e,new Ut),is=class{constructor(){this.l=[]}},Fo=()=>new is,jo=(e,t)=>e.l.push(t),qo=(e,t)=>{let n=e.l,r=n.length;e.l=n.filter(s=>t!==s),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},si=(e,t,n)=>Fe(e.l,[t,n]),pt=class{constructor(t,n){this.client=t,this.clock=n}},Mt=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,y=(e,t)=>new pt(e,t),Po=(e,t)=>{m(e,t.client),m(e,t.clock)},Yo=e=>y(w(e),w(e)),ks=e=>{for(let[t,n]of e.doc.share.entries())if(n===e)return t;throw v()},Qe=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1},Fl=e=>{let t=[],n=e._start;for(;n;)t.push(n),n=n.right;console.log("Children: ",t),console.log("Children content: ",t.filter(r=>!r.deleted).map(r=>r.content))},cs=class{constructor(t,n=t.getMap("users")){let r=new Map;this.yusers=n,this.doc=t,this.clients=new Map,this.dss=r;let s=(o,i)=>{let c=o.get("ds"),l=o.get("ids"),a=h=>this.clients.set(h,i);c.observe(h=>{h.changes.added.forEach(d=>{d.content.getContent().forEach(u=>{u instanceof Uint8Array&&this.dss.set(i,$t([this.dss.get(i)||nr(),gt(new Ft(D(u)))]))})})}),this.dss.set(i,$t(c.map(h=>gt(new Ft(D(h)))))),l.observe(h=>h.changes.added.forEach(d=>d.content.getContent().forEach(a))),l.forEach(a)};n.observe(o=>{o.keysChanged.forEach(i=>s(n.get(i),i))}),n.forEach(s)}setUserMapping(t,n,r,{filter:s=()=>!0}={}){let o=this.yusers,i=o.get(r);i||(i=new Yt,i.set("ids",new Pt),i.set("ds",new Pt),o.set(r,i)),i.get("ids").push([n]),o.observe(c=>{setTimeout(()=>{let l=o.get(r);if(l!==i){i=l,this.clients.forEach((d,u)=>{r===d&&i.get("ids").push([u])});let a=new Ut,h=this.dss.get(r);h&&(lt(a,h),i.get("ds").push([a.toUint8Array()]))}},0)}),t.on("afterTransaction",c=>{setTimeout(()=>{let l=i.get("ds"),a=c.deleteSet;if(c.local&&a.clients.size>0&&s(c,a)){let h=new Ut;lt(h,a),l.push([h.toUint8Array()])}})})}getUserByClientId(t){return this.clients.get(t)||null}getUserByDeletedId(t){for(let[n,r]of this.dss.entries())if(Xt(r,t))return n;return null}},Se=class{constructor(t,n,r,s=0){this.type=t,this.tname=n,this.item=r,this.assoc=s}},sr=e=>{let t={};return e.type&&(t.type=e.type),e.tname&&(t.tname=e.tname),e.item&&(t.item=e.item),e.assoc!=null&&(t.assoc=e.assoc),t},wt=e=>{var t;return new Se(e.type==null?null:y(e.type.client,e.type.clock),(t=e.tname)!=null?t:null,e.item==null?null:y(e.item.client,e.item.clock),e.assoc==null?0:e.assoc)},zn=class{constructor(t,n,r=0){this.type=t,this.index=n,this.assoc=r}},jl=(e,t,n=0)=>new zn(e,t,n),$n=(e,t,n)=>{let r=null,s=null;return e._item===null?s=ks(e):r=y(e._item.id.client,e._item.id.clock),new Se(r,s,t,n)},Ce=(e,t,n=0)=>{let r=e._start;if(n<0){if(t===0)return $n(e,null,n);t--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>t)return $n(e,y(r.id.client,r.id.clock+t),n);t-=r.length}if(r.right===null&&n<0)return $n(e,r.lastId,n);r=r.right}return $n(e,null,n)},ql=(e,t)=>{let{type:n,tname:r,item:s,assoc:o}=t;if(s!==null)m(e,0),Po(e,s);else if(r!==null)ce(e,1),rt(e,r);else if(n!==null)ce(e,2),Po(e,n);else throw v();return Ne(e,o),e},Pl=e=>{let t=ut();return ql(t,e),F(t)},Yl=e=>{let t=null,n=null,r=null;switch(w(e)){case 0:r=Yo(e);break;case 1:n=st(e);break;case 2:t=Yo(e)}let s=Cr(e)?Re(e):0;return new Se(t,n,r,s)},zl=e=>Yl(D(e)),Gl=(e,t)=>{let n=Rt(e,t),r=t.clock-n.id.clock;return{item:n,diff:r}},Ae=(e,t,n=!0)=>{let r=t.store,s=e.item,o=e.type,i=e.tname,c=e.assoc,l=null,a=0;if(s!==null){if(_(r,s.client)<=s.clock)return null;let h=n?fs(r,s):Gl(r,s),d=h.item;if(!(d instanceof S))return null;if(l=d.parent,l._item===null||!l._item.deleted){a=d.deleted||!d.countable?0:h.diff+(c>=0?0:1);let u=d.left;for(;u!==null;)!u.deleted&&u.countable&&(a+=u.length),u=u.left}}else{if(i!==null)l=t.get(i);else if(o!==null){if(_(r,o.client)<=o.clock)return null;let{item:h}=n?fs(r,o):{item:Rt(r,o)};if(h instanceof S&&h.content instanceof Z)l=h.content.type;else return null}else throw v();c>=0?a=l._length:a=0}return jl(l,a,e.assoc)},or=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&Mt(e.item,t.item)&&Mt(e.type,t.type)&&e.assoc===t.assoc,tn=class{constructor(t,n){this.ds=t,this.sv=n}},Jl=(e,t)=>{let n=e.ds.clients,r=t.ds.clients,s=e.sv,o=t.sv;if(s.size!==o.size||n.size!==r.size)return!1;for(let[i,c]of s.entries())if(o.get(i)!==c)return!1;for(let[i,c]of n.entries()){let l=r.get(i)||[];if(c.length!==l.length)return!1;for(let a=0;a<c.length;a++){let h=c[a],d=l[a];if(h.clock!==d.clock||h.len!==d.len)return!1}}return!0},oi=(e,t=new ke)=>(lt(t,e.ds),bs(t,e.sv),t.toUint8Array()),Hl=e=>oi(e,new Ut),ii=(e,t=new Yn(D(e)))=>new tn(gt(t),ri(t)),Xl=e=>ii(e,new Ft(D(e))),Ss=(e,t)=>new tn(e,t),Kl=Ss(nr(),new Map),Wl=e=>Ss(ms(e.store),an(e.store)),bt=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Xt(t.ds,e.id),ls=(e,t)=>{let n=R(e.meta,ls,nt),r=e.doc.store;n.has(t)||(t.sv.forEach((s,o)=>{s<_(r,o)&&B(e,y(o,s))}),Bt(e,t.ds,s=>{}),n.add(t))},Zl=(e,t,n=new Et)=>{if(e.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");let{sv:r,ds:s}=t,o=new H;return e.transact(i=>{let c=0;r.forEach(l=>{l>0&&c++}),m(o.restEncoder,c);for(let[l,a]of r){if(a===0)continue;a<_(e.store,l)&&B(i,y(l,a));let h=e.store.clients.get(l)||[],d=W(h,a-1);m(o.restEncoder,d+1),o.writeClient(l),m(o.restEncoder,0);for(let u=0;u<=d;u++)h[u].write(o,0)}lt(o,s)}),rr(n,o.toUint8Array(),"snapshot"),n},Ql=(e,t,n=q)=>{let r=new n(D(t)),s=new ht(r,!1);for(let i=s.curr;i!==null;i=s.next())if((e.sv.get(i.id.client)||0)<i.id.clock+i.length)return!1;let o=$t([e.ds,gt(r)]);return ti(e.ds,o)},ta=(e,t)=>Ql(e,t,z),Gn=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},an=e=>{let t=new Map;return e.clients.forEach((n,r)=>{let s=n[n.length-1];t.set(r,s.id.clock+s.length)}),t},_=(e,t)=>{let n=e.clients.get(t);if(n===void 0)return 0;let r=n[n.length-1];return r.id.clock+r.length},ci=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{let r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw v()}n.push(t)},W=(e,t)=>{let n=0,r=e.length-1,s=e[r],o=s.id.clock;if(o===t)return r;let i=L(t/(o+s.length-1)*r);for(;n<=r;){if(s=e[i],o=s.id.clock,o<=t){if(t<o+s.length)return i;n=i+1}else r=i-1;i=L((n+r)/2)}throw v()},ea=(e,t)=>{let n=e.clients.get(t.client);return n[W(n,t.clock)]},Rt=ea,as=(e,t,n)=>{let r=W(t,n),s=t[r];return s.id.clock<n&&s instanceof S?(t.splice(r+1,0,er(e,s,n-s.id.clock)),r+1):r},B=(e,t)=>{let n=e.doc.store.clients.get(t.client);return n[as(e,n,t.clock)]},hs=(e,t,n)=>{let r=t.clients.get(n.client),s=W(r,n.clock),o=r[s];return n.clock!==o.id.clock+o.length-1&&o.constructor!==$&&r.splice(s+1,0,er(e,o,n.clock-o.id.clock+1)),o},na=(e,t,n)=>{let r=e.clients.get(t.id.client);r[W(r,t.id.clock)]=n},li=(e,t,n,r,s)=>{if(r===0)return;let o=n+r,i=as(e,t,n),c;do c=t[i++],o<c.id.clock+c.length&&as(e,t,o),s(c);while(i<t.length&&t[i].id.clock<o)},Jn=class{constructor(t,n,r){this.doc=t,this.deleteSet=new _t,this.beforeState=an(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},zo=(e,t)=>t.deleteSet.clients.size===0&&!js(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(gs(t.deleteSet),Vl(e,t),lt(e,t.deleteSet),!0),Go=(e,t,n)=>{let r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&R(e.changed,t,nt).add(n)},qn=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0;n=r,r=e[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof S&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}let o=t-s;return o&&e.splice(t+1-o,o),o},ai=(e,t,n)=>{for(let[r,s]of e.clients.entries()){let o=t.clients.get(r);for(let i=s.length-1;i>=0;i--){let c=s[i],l=c.clock+c.len;for(let a=W(o,c.clock),h=o[a];a<o.length&&h.id.clock<l;h=o[++a]){let d=o[a];if(c.clock+c.len<=d.id.clock)break;d instanceof S&&d.deleted&&!d.keep&&n(d)&&d.gc(t,!1)}}}},hi=(e,t)=>{e.clients.forEach((n,r)=>{let s=t.clients.get(r);for(let o=n.length-1;o>=0;o--){let i=n[o],c=te(s.length-1,1+W(s,i.clock+i.len-1));for(let l=c,a=s[l];l>0&&a.id.clock>=i.clock;a=s[l])l-=1+qn(s,l)}})},ra=(e,t,n)=>{ai(e,t,n),hi(e,t)},di=(e,t)=>{if(t<e.length){let n=e[t],r=n.doc,s=r.store,o=n.deleteSet,i=n._mergeStructs;try{gs(o),n.afterState=an(n.doc.store),r.emit("beforeObserverCalls",[n,r]);let c=[];n.changed.forEach((l,a)=>c.push(()=>{(a._item===null||!a._item.deleted)&&a._callObserver(n,l)})),c.push(()=>{n.changedParentTypes.forEach((l,a)=>{a._dEH.l.length>0&&(a._item===null||!a._item.deleted)&&(l=l.filter(h=>h.target._item===null||!h.target._item.deleted),l.forEach(h=>{h.currentTarget=a,h._path=null}),l.sort((h,d)=>h.path.length-d.path.length),c.push(()=>{si(a._dEH,l,n)}))}),c.push(()=>r.emit("afterTransaction",[n,r])),c.push(()=>{n._needFormattingCleanup&&Ua(n)})}),Fe(c,[])}finally{r.gc&&ai(o,s,r.gcFilter),hi(o,s),n.afterState.forEach((h,d)=>{let u=n.beforeState.get(d)||0;if(u!==h){let f=s.clients.get(d),p=tt(W(f,u),1);for(let b=f.length-1;b>=p;)b-=1+qn(f,b)}});for(let h=i.length-1;h>=0;h--){let{client:d,clock:u}=i[h].id,f=s.clients.get(d),p=W(f,u);p+1<f.length&&qn(f,p+1)>1||p>0&&qn(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Rn(be,Je,"[yjs] ",He,Xe,"Changed the client-id because another client seems to be using it."),r.clientID=ei()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){let h=new at;zo(h,n)&&r.emit("update",[h.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){let h=new H;zo(h,n)&&r.emit("updateV2",[h.toUint8Array(),n.origin,r,n])}let{subdocsAdded:c,subdocsLoaded:l,subdocsRemoved:a}=n;(c.size>0||a.size>0||l.size>0)&&(c.forEach(h=>{h.clientID=r.clientID,h.collectionid==null&&(h.collectionid=r.collectionid),r.subdocs.add(h)}),a.forEach(h=>r.subdocs.delete(h)),r.emit("subdocs",[{loaded:l,added:c,removed:a},r,n]),a.forEach(h=>h.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):di(e,t+1)}}},k=(e,t,n=null,r=!0)=>{let s=e._transactionCleanups,o=!1,i=null;e._transaction===null&&(o=!0,e._transaction=new Jn(e,n,r),s.push(e._transaction),s.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{i=t(e._transaction)}finally{if(o){let c=e._transaction===s[0];e._transaction=null,c&&di(s,0)}}return i},ds=class{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}},Jo=(e,t,n)=>{Bt(e,n.deletions,r=>{r instanceof S&&t.scope.some(s=>s===e.doc||Qe(s,r))&&Ds(r,!1)})},Ho=(e,t,n)=>{let r=null,s=e.doc,o=e.scope;k(s,c=>{for(;t.length>0&&e.currStackItem===null;){let l=s.store,a=t.pop(),h=new Set,d=[],u=!1;Bt(c,a.insertions,f=>{if(f instanceof S){if(f.redone!==null){let{item:p,diff:b}=fs(l,f.id);b>0&&(p=B(c,y(p.id.client,p.id.clock+b))),f=p}!f.deleted&&o.some(p=>p===c.doc||Qe(p,f))&&d.push(f)}}),Bt(c,a.deletions,f=>{f instanceof S&&o.some(p=>p===c.doc||Qe(p,f))&&!Xt(a.insertions,f.id)&&h.add(f)}),h.forEach(f=>{u=Bi(c,f,h,a.insertions,e.ignoreRemoteMapChanges,e)!==null||u});for(let f=d.length-1;f>=0;f--){let p=d[f];e.deleteFilter(p)&&(p.delete(c),u=!0)}e.currStackItem=u?a:null}c.changed.forEach((l,a)=>{l.has(null)&&a._searchMarker&&(a._searchMarker.length=0)}),r=c},e);let i=e.currStackItem;if(i!=null){let c=r.changedParentTypes;e.emit("stack-item-popped",[{stackItem:i,type:n,changedParentTypes:c,origin:e},e]),e.currStackItem=null}return i},jt=class extends Qt{constructor(t,{captureTimeout:n=500,captureTransaction:r=l=>!0,deleteFilter:s=()=>!0,trackedOrigins:o=new Set([null]),ignoreRemoteMapChanges:i=!1,doc:c=dt(t)?t[0].doc:t instanceof Et?t:t.doc}={}){super(),this.scope=[],this.doc=c,this.addToScope(t),this.deleteFilter=s,o.add(this),this.trackedOrigins=o,this.captureTransaction=r,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=i,this.captureTimeout=n,this.afterTransactionHandler=l=>{if(!this.captureTransaction(l)||!this.scope.some(g=>l.changedParentTypes.has(g)||g===this.doc)||!this.trackedOrigins.has(l.origin)&&(!l.origin||!this.trackedOrigins.has(l.origin.constructor)))return;let a=this.undoing,h=this.redoing,d=a?this.redoStack:this.undoStack;a?this.stopCapturing():h||this.clear(!1,!0);let u=new _t;l.afterState.forEach((g,x)=>{let O=l.beforeState.get(x)||0,Zt=g-O;Zt>0&&Ze(u,x,O,Zt)});let f=ft(),p=!1;if(this.lastChange>0&&f-this.lastChange<this.captureTimeout&&d.length>0&&!a&&!h){let g=d[d.length-1];g.deletions=$t([g.deletions,l.deleteSet]),g.insertions=$t([g.insertions,u])}else d.push(new ds(l.deleteSet,u)),p=!0;!a&&!h&&(this.lastChange=f),Bt(l,l.deleteSet,g=>{g instanceof S&&this.scope.some(x=>x===l.doc||Qe(x,g))&&Ds(g,!0)});let b=[{stackItem:d[d.length-1],origin:l.origin,type:a?"redo":"undo",changedParentTypes:l.changedParentTypes},this];p?this.emit("stack-item-added",b):this.emit("stack-item-updated",b)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){let n=new Set(this.scope);t=dt(t)?t:[t],t.forEach(r=>{n.has(r)||(n.add(r),(r instanceof U?r.doc!==this.doc:r!==this.doc)&&rs("[yjs#509] Not same Y.Doc"),this.scope.push(r))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(r=>{t&&(this.undoStack.forEach(s=>Jo(r,this,s)),this.undoStack=[]),n&&(this.redoStack.forEach(s=>Jo(r,this,s)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=Ho(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=Ho(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}};function*sa(e){let t=w(e.restDecoder);for(let n=0;n<t;n++){let r=w(e.restDecoder),s=e.readClient(),o=w(e.restDecoder);for(let i=0;i<r;i++){let c=e.readInfo();if(c===10){let l=w(e.restDecoder);yield new N(y(s,o),l),o+=l}else if((31&c)!==0){let l=(c&192)===0,a=new S(y(s,o),null,(c&128)===128?e.readLeftID():null,null,(c&64)===64?e.readRightID():null,l?e.readParentInfo()?e.readString():e.readLeftID():null,l&&(c&32)===32?e.readString():null,$i(e,c));yield a,o+=a.length}else{let l=e.readLen();yield new $(y(s,o),l),o+=l}}}}var ht=class{constructor(t,n){this.gen=sa(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===N);return this.curr}},oa=e=>ui(e,z),ui=(e,t=q)=>{let n=[],r=new t(D(e)),s=new ht(r,!1);for(let i=s.curr;i!==null;i=s.next())n.push(i);Rn("Structs: ",n);let o=gt(r);Rn("DeleteSet: ",o)},ia=e=>fi(e,z),fi=(e,t=q)=>{let n=[],r=new t(D(e)),s=new ht(r,!1);for(let o=s.curr;o!==null;o=s.next())n.push(o);return{structs:n,ds:gt(r)}},en=class{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}},pi=e=>nn(e,z,at),gi=(e,t=ke,n=q)=>{let r=new t,s=new ht(new n(D(e)),!1),o=s.curr;if(o!==null){let i=0,c=o.id.client,l=o.id.clock!==0,a=l?0:o.id.clock+o.length;for(;o!==null;o=s.next())c!==o.id.client&&(a!==0&&(i++,m(r.restEncoder,c),m(r.restEncoder,a)),c=o.id.client,a=0,l=o.id.clock!==0),o.constructor===N&&(l=!0),l||(a=o.id.clock+o.length);a!==0&&(i++,m(r.restEncoder,c),m(r.restEncoder,a));let h=ut();return m(h,i),Ks(h,r.restEncoder),r.restEncoder=h,r.toUint8Array()}else return m(r.restEncoder,0),r.toUint8Array()},ca=e=>gi(e,Ut,z),mi=(e,t=q)=>{let n=new Map,r=new Map,s=new ht(new t(D(e)),!1),o=s.curr;if(o!==null){let i=o.id.client,c=o.id.clock;for(n.set(i,c);o!==null;o=s.next())i!==o.id.client&&(r.set(i,c),n.set(o.id.client,o.id.clock),i=o.id.client),c=o.id.clock+o.length;r.set(i,c)}return{from:n,to:r}},la=e=>mi(e,z),aa=(e,t)=>{if(e.constructor===$){let{client:n,clock:r}=e.id;return new $(y(n,r+t),e.length-t)}else if(e.constructor===N){let{client:n,clock:r}=e.id;return new N(y(n,r+t),e.length-t)}else{let n=e,{client:r,clock:s}=n.id;return new S(y(r,s+t),null,y(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},nn=(e,t=q,n=H)=>{if(e.length===1)return e[0];let r=e.map(h=>new t(D(h))),s=r.map(h=>new ht(h,!0)),o=null,i=new n,c=new en(i);for(;s=s.filter(u=>u.curr!==null),s.sort((u,f)=>{if(u.curr.id.client===f.curr.id.client){let p=u.curr.id.clock-f.curr.id.clock;return p===0?u.curr.constructor===f.curr.constructor?0:u.curr.constructor===N?1:-1:p}else return f.curr.id.client-u.curr.id.client}),s.length!==0;){let h=s[0],d=h.curr.id.client;if(o!==null){let u=h.curr,f=!1;for(;u!==null&&u.id.clock+u.length<=o.struct.id.clock+o.struct.length&&u.id.client>=o.struct.id.client;)u=h.next(),f=!0;if(u===null||u.id.client!==d||f&&u.id.clock>o.struct.id.clock+o.struct.length)continue;if(d!==o.struct.id.client)kt(c,o.struct,o.offset),o={struct:u,offset:0},h.next();else if(o.struct.id.clock+o.struct.length<u.id.clock)if(o.struct.constructor===N)o.struct.length=u.id.clock+u.length-o.struct.id.clock;else{kt(c,o.struct,o.offset);let p=u.id.clock-o.struct.id.clock-o.struct.length;o={struct:new N(y(d,o.struct.id.clock+o.struct.length),p),offset:0}}else{let p=o.struct.id.clock+o.struct.length-u.id.clock;p>0&&(o.struct.constructor===N?o.struct.length-=p:u=aa(u,p)),o.struct.mergeWith(u)||(kt(c,o.struct,o.offset),o={struct:u,offset:0},h.next())}}else o={struct:h.curr,offset:0},h.next();for(let u=h.curr;u!==null&&u.id.client===d&&u.id.clock===o.struct.id.clock+o.struct.length&&u.constructor!==N;u=h.next())kt(c,o.struct,o.offset),o={struct:u,offset:0}}o!==null&&(kt(c,o.struct,o.offset),o=null),Es(c);let l=r.map(h=>gt(h)),a=$t(l);return lt(i,a),i.toUint8Array()},_s=(e,t,n=q,r=H)=>{let s=xs(t),o=new r,i=new en(o),c=new n(D(e)),l=new ht(c,!1);for(;l.curr;){let h=l.curr,d=h.id.client,u=s.get(d)||0;if(l.curr.constructor===N){l.next();continue}if(h.id.clock+h.length>u)for(kt(i,h,tt(u-h.id.clock,0)),l.next();l.curr&&l.curr.id.client===d;)kt(i,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===d&&l.curr.id.clock+l.curr.length<=u;)l.next()}Es(i);let a=gt(c);return lt(o,a),o.toUint8Array()},ha=(e,t)=>_s(e,t,z,at),wi=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:F(e.encoder.restEncoder)}),e.encoder.restEncoder=ut(),e.written=0)},kt=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&wi(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),m(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Es=e=>{wi(e);let t=e.encoder.restEncoder;m(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){let r=e.clientStructs[n];m(t,r.written),le(t,r.restEncoder)}},ir=(e,t,n,r)=>{let s=new n(D(e)),o=new ht(s,!1),i=new r,c=new en(i);for(let a=o.curr;a!==null;a=o.next())kt(c,t(a),0);Es(c);let l=gt(s);return lt(i,l),i.toUint8Array()},yi=({formatting:e=!0,subdocs:t=!0,yxml:n=!0}={})=>{let r=0,s=E(),o=E(),i=E(),c=E();return c.set(null,null),l=>{switch(l.constructor){case $:case N:return l;case S:{let a=l,h=a.content;switch(h.constructor){case Ue:break;case Z:{if(n){let d=h.type;d instanceof Gt&&(d.nodeName=R(o,d.nodeName,()=>"node-"+r)),d instanceof cn&&(d.hookName=R(o,d.hookName,()=>"hook-"+r))}break}case Ct:{let d=h;d.arr=d.arr.map(()=>r);break}case Jt:{let d=h;d.content=new Uint8Array([r]);break}case Ht:{let d=h;t&&(d.opts={},d.doc.guid=r+"");break}case mt:{let d=h;d.embed={};break}case C:{let d=h;e&&(d.key=R(i,d.key,()=>r+""),d.value=R(c,d.value,()=>({i:r})));break}case ln:{let d=h;d.arr=d.arr.map(()=>r);break}case et:{let d=h;d.str=wn(r%10+"",d.str.length);break}default:v()}return a.parentSub&&(a.parentSub=R(s,a.parentSub,()=>r+"")),r++,l}default:v()}}},da=(e,t)=>ir(e,yi(t),z,at),ua=(e,t)=>ir(e,yi(t),q,H),fa=e=>ir(e,Rr,z,H),xi=e=>ir(e,Rr,q,at),Xo="You must not compute changes after the event-handler fired.",qt=class{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=pa(this.currentTarget,this.target))}deletes(t){return Xt(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw G(Xo);let t=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){let o=n._map.get(s),i,c;if(this.adds(o)){let l=o.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(o))if(l!==null&&this.deletes(l))i="delete",c=fn(l.content.getContent());else return;else l!==null&&this.deletes(l)?(i="update",c=fn(l.content.getContent())):(i="add",c=void 0)}else if(this.deletes(o))i="delete",c=fn(o.content.getContent());else return;t.set(s,{action:i,oldValue:c})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw G(Xo);let n=this.target,r=nt(),s=nt(),o=[];if(t={added:r,deleted:s,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let c=null,l=()=>{c&&o.push(c)};for(let a=n._start;a!==null;a=a.right)a.deleted?this.deletes(a)&&!this.adds(a)&&((c===null||c.delete===void 0)&&(l(),c={delete:0}),c.delete+=a.length,s.add(a)):this.adds(a)?((c===null||c.insert===void 0)&&(l(),c={insert:[]}),c.insert=c.insert.concat(a.content.getContent()),r.add(a)):((c===null||c.retain===void 0)&&(l(),c={retain:0}),c.retain+=a.length);c!==null&&c.retain===void 0&&l()}this._changes=t}return t}},pa=(e,t)=>{let n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,s=t._item.parent._start;for(;s!==t._item&&s!==null;)!s.deleted&&s.countable&&(r+=s.length),s=s.right;n.unshift(r)}t=t._item.parent}return n},M=()=>{rs("Invalid access: Add Yjs type to a document before reading data.")},bi=80,Us=0,us=class{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Us++}},ga=e=>{e.timestamp=Us++},ki=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Us++},ma=(e,t,n)=>{if(e.length>=bi){let r=e.reduce((s,o)=>s.timestamp<o.timestamp?s:o);return ki(r,t,n),r}else{let r=new us(t,n);return e.push(r),r}},cr=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;let n=e._searchMarker.length===0?null:e._searchMarker.reduce((o,i)=>It(t-o.index)<It(t-i.index)?o:i),r=e._start,s=0;for(n!==null&&(r=n.p,s=n.index,ga(n));r.right!==null&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&It(n.index-s)<r.parent.length/bi?(ki(n,r,s),n):ma(e._searchMarker,r,s)},rn=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){let s=e[r];if(n>0){let o=s.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(s.index-=o.length);if(o===null||o.marker===!0){e.splice(r,1);continue}s.p=o,o.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=tt(t,s.index+n))}},wa=e=>{var r;(r=e.doc)!=null||M();let t=e._start,n=[];for(;t;)n.push(t),t=t.right;return n},lr=(e,t,n)=>{let r=e,s=t.changedParentTypes;for(;R(s,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;si(r._eH,n,t)},U=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Fo(),this._dEH=Fo(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw J()}clone(){throw J()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){jo(this._eH,t)}observeDeep(t){jo(this._dEH,t)}unobserve(t){qo(this._eH,t)}unobserveDeep(t){qo(this._dEH,t)}toJSON(){}},Si=(e,t,n)=>{var i;(i=e.doc)!=null||M(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t,s=[],o=e._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){let c=o.content.getContent();if(c.length<=t)t-=c.length;else{for(let l=t;l<c.length&&r>0;l++)s.push(c[l]),r--;t=0}}o=o.right}return s},_i=e=>{var r;(r=e.doc)!=null||M();let t=[],n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){let s=n.content.getContent();for(let o=0;o<s.length;o++)t.push(s[o])}n=n.right}return t},ya=(e,t)=>{let n=[],r=e._start;for(;r!==null;){if(r.countable&&bt(r,t)){let s=r.content.getContent();for(let o=0;o<s.length;o++)n.push(s[o])}r=r.right}return n},sn=(e,t)=>{var s;let n=0,r=e._start;for((s=e.doc)!=null||M();r!==null;){if(r.countable&&!r.deleted){let o=r.content.getContent();for(let i=0;i<o.length;i++)t(o[i],n++,e)}r=r.right}},Ei=(e,t)=>{let n=[];return sn(e,(r,s)=>{n.push(t(r,s,e))}),n},xa=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}let s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},Ui=(e,t)=>{var s;(s=e.doc)!=null||M();let n=cr(e,t),r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Hn=(e,t,n,r)=>{let s=n,o=e.doc,i=o.clientID,c=o.store,l=n===null?t._start:n.right,a=[],h=()=>{a.length>0&&(s=new S(y(i,_(c,i)),s,s&&s.lastId,l,l&&l.id,t,null,new Ct(a)),s.integrate(e,0),a=[])};r.forEach(d=>{if(d===null)a.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:a.push(d);break;default:switch(h(),d.constructor){case Uint8Array:case ArrayBuffer:s=new S(y(i,_(c,i)),s,s&&s.lastId,l,l&&l.id,t,null,new Jt(new Uint8Array(d))),s.integrate(e,0);break;case Et:s=new S(y(i,_(c,i)),s,s&&s.lastId,l,l&&l.id,t,null,new Ht(d)),s.integrate(e,0);break;default:if(d instanceof U)s=new S(y(i,_(c,i)),s,s&&s.lastId,l,l&&l.id,t,null,new Z(d)),s.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),h()},Ci=()=>G("Length exceeded!"),Ai=(e,t,n,r)=>{if(n>t._length)throw Ci();if(n===0)return t._searchMarker&&rn(t._searchMarker,n,r.length),Hn(e,t,null,r);let s=n,o=cr(t,n),i=t._start;for(o!==null&&(i=o.p,n-=o.index,n===0&&(i=i.prev,n+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(n<=i.length){n<i.length&&B(e,y(i.id.client,i.id.clock+n));break}n-=i.length}return t._searchMarker&&rn(t._searchMarker,s,r.length),Hn(e,t,i,r)},ba=(e,t,n)=>{let s=(t._searchMarker||[]).reduce((o,i)=>i.index>o.index?i:o,{index:0,p:t._start}).p;if(s)for(;s.right;)s=s.right;return Hn(e,t,s,n)},Di=(e,t,n,r)=>{if(r===0)return;let s=n,o=r,i=cr(t,n),c=t._start;for(i!==null&&(c=i.p,n-=i.index);c!==null&&n>0;c=c.right)!c.deleted&&c.countable&&(n<c.length&&B(e,y(c.id.client,c.id.clock+n)),n-=c.length);for(;r>0&&c!==null;)c.deleted||(r<c.length&&B(e,y(c.id.client,c.id.clock+r)),c.delete(e),r-=c.length),c=c.right;if(r>0)throw Ci();t._searchMarker&&rn(t._searchMarker,s,-o+r)},Xn=(e,t,n)=>{let r=t._map.get(n);r!==void 0&&r.delete(e)},Cs=(e,t,n,r)=>{let s=t._map.get(n)||null,o=e.doc,i=o.clientID,c;if(r==null)c=new Ct([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:c=new Ct([r]);break;case Uint8Array:c=new Jt(r);break;case Et:c=new Ht(r);break;default:if(r instanceof U)c=new Z(r);else throw new Error("Unexpected content type")}new S(y(i,_(o.store,i)),s,s&&s.lastId,null,null,t,n,c).integrate(e,0)},As=(e,t)=>{var r;(r=e.doc)!=null||M();let n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Ii=e=>{var n;let t={};return(n=e.doc)!=null||M(),e._map.forEach((r,s)=>{r.deleted||(t[s]=r.content.getContent()[r.length-1])}),t},Ti=(e,t)=>{var r;(r=e.doc)!=null||M();let n=e._map.get(t);return n!==void 0&&!n.deleted},ka=(e,t,n)=>{let r=e._map.get(t)||null;for(;r!==null&&(!n.sv.has(r.id.client)||r.id.clock>=(n.sv.get(r.id.client)||0));)r=r.left;return r!==null&&bt(r,n)?r.content.getContent()[r.length-1]:void 0},vi=(e,t)=>{let n={};return e._map.forEach((r,s)=>{let o=r;for(;o!==null&&(!t.sv.has(o.id.client)||o.id.clock>=(t.sv.get(o.id.client)||0));)o=o.left;o!==null&&bt(o,t)&&(n[s]=o.content.getContent()[o.length-1])}),n},Fn=e=>{var t;return(t=e.doc)!=null||M(),Mo(e._map.entries(),n=>!n[1].deleted)},Kn=class extends qt{},Pt=class e extends U{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){let n=new e;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return t.insert(0,this.toArray().map(n=>n instanceof U?n.clone():n)),t}get length(){var t;return(t=this.doc)!=null||M(),this._length}_callObserver(t,n){super._callObserver(t,n),lr(this,t,new Kn(this,t))}insert(t,n){this.doc!==null?k(this.doc,r=>{Ai(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?k(this.doc,n=>{ba(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?k(this.doc,r=>{Di(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Ui(this,t)}toArray(){return _i(this)}slice(t=0,n=this.length){return Si(this,t,n)}toJSON(){return this.map(t=>t instanceof U?t.toJSON():t)}map(t){return Ei(this,t)}forEach(t){sn(this,t)}[Symbol.iterator](){return xa(this)}_write(t){t.writeTypeRef(qa)}},Sa=e=>new Pt,Wn=class extends qt{constructor(t,n,r){super(t,n),this.keysChanged=r}},Yt=class e extends U{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return this.forEach((n,r)=>{t.set(r,n instanceof U?n.clone():n)}),t}_callObserver(t,n){lr(this,t,new Wn(this,t,n))}toJSON(){var n;(n=this.doc)!=null||M();let t={};return this._map.forEach((r,s)=>{if(!r.deleted){let o=r.content.getContent()[r.length-1];t[s]=o instanceof U?o.toJSON():o}}),t}get size(){return[...Fn(this)].length}keys(){return Bn(Fn(this),t=>t[0])}values(){return Bn(Fn(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Bn(Fn(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){var n;(n=this.doc)!=null||M(),this._map.forEach((r,s)=>{r.deleted||t(r.content.getContent()[r.length-1],s,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?k(this.doc,n=>{Xn(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?k(this.doc,r=>{Cs(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return As(this,t)}has(t){return Ti(this,t)}clear(){this.doc!==null?k(this.doc,t=>{this.forEach(function(n,r,s){Xn(t,s,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Pa)}},_a=e=>new Yt,St=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Lr(e,t),on=class{constructor(t,n,r,s){this.left=t,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&v(),this.right.content.constructor){case C:this.right.deleted||De(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},Ko=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case C:t.right.deleted||De(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&B(e,y(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},jn=(e,t,n,r)=>{let s=new Map,o=r?cr(t,n):null;if(o){let i=new on(o.p.left,o.p,o.index,s);return Ko(e,i,n-o.index)}else{let i=new on(null,t._start,0,s);return Ko(e,i,n)}},Vi=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===C&&St(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();let s=e.doc,o=s.clientID;r.forEach((i,c)=>{let l=n.left,a=n.right,h=new S(y(o,_(s.store,o)),l,l&&l.lastId,a,a&&a.id,t,null,new C(c,i));h.integrate(e,0),n.right=h,n.forward()})},De=(e,t)=>{let{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},Oi=(e,t)=>{var n;for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===C&&St((n=t[e.right.content.key])!=null?n:null,e.right.content.value)))break;e.forward()}},Li=(e,t,n,r)=>{var c;let s=e.doc,o=s.clientID,i=new Map;for(let l in r){let a=r[l],h=(c=n.currentAttributes.get(l))!=null?c:null;if(!St(h,a)){i.set(l,h);let{left:d,right:u}=n;n.right=new S(y(o,_(s.store,o)),d,d&&d.lastId,u,u&&u.id,t,null,new C(l,a)),n.right.integrate(e,0),n.forward()}}return i},ss=(e,t,n,r,s)=>{n.currentAttributes.forEach((u,f)=>{s[f]===void 0&&(s[f]=null)});let o=e.doc,i=o.clientID;Oi(n,s);let c=Li(e,t,n,s),l=r.constructor===String?new et(r):r instanceof U?new Z(r):new mt(r),{left:a,right:h,index:d}=n;t._searchMarker&&rn(t._searchMarker,n.index,l.getLength()),h=new S(y(i,_(o.store,i)),a,a&&a.lastId,h,h&&h.id,t,null,l),h.integrate(e,0),n.right=h,n.index=d,n.forward(),Vi(e,t,n,c)},Wo=(e,t,n,r,s)=>{let o=e.doc,i=o.clientID;Oi(n,s);let c=Li(e,t,n,s);t:for(;n.right!==null&&(r>0||c.size>0&&(n.right.deleted||n.right.content.constructor===C));){if(!n.right.deleted)switch(n.right.content.constructor){case C:{let{key:l,value:a}=n.right.content,h=s[l];if(h!==void 0){if(St(h,a))c.delete(l);else{if(r===0)break t;c.set(l,a)}n.right.delete(e)}else n.currentAttributes.set(l,a);break}default:r<n.right.length&&B(e,y(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;n.right=new S(y(i,_(o.store,i)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new et(l)),n.right.integrate(e,0),n.forward()}Vi(e,t,n,c)},Ni=(e,t,n,r,s)=>{var a,h;let o=t,i=E();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===C){let d=o.content;i.set(d.key,d)}o=o.right}let c=0,l=!1;for(;t!==o;){if(n===t&&(l=!0),!t.deleted){let d=t.content;switch(d.constructor){case C:{let{key:u,value:f}=d,p=(a=r.get(u))!=null?a:null;(i.get(u)!==d||p===f)&&(t.delete(e),c++,!l&&((h=s.get(u))!=null?h:null)===f&&p!==f&&(p===null?s.delete(u):s.set(u,p))),!l&&!t.deleted&&De(s,d);break}}}t=t.right}return c},Ea=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;let n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===C){let r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Mi=e=>{let t=0;return k(e.doc,n=>{let r=e._start,s=e._start,o=E(),i=un(o);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case C:De(i,s.content);break;default:t+=Ni(n,r,s,o,i),o=un(i),r=s;break}s=s.right}}),t},Ua=e=>{let t=new Set,n=e.doc;for(let[r,s]of e.afterState.entries()){let o=e.beforeState.get(r)||0;s!==o&&li(e,n.store.clients.get(r),o,s,i=>{!i.deleted&&i.content.constructor===C&&i.constructor!==$&&t.add(i.parent)})}k(n,r=>{Bt(e,e.deleteSet,s=>{if(s instanceof $||!s.parent._hasFormatting||t.has(s.parent))return;let o=s.parent;s.content.constructor===C?t.add(o):Ea(r,s)});for(let s of t)Mi(s)})},Zo=(e,t,n)=>{let r=n,s=un(t.currentAttributes),o=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Z:case mt:case et:n<t.right.length&&B(e,y(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}o&&Ni(e,o,t.right,s,t.currentAttributes);let i=(t.left||t.right).parent;return i._searchMarker&&rn(i._searchMarker,t.index,-r+n),t},Zn=class extends qt{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){let t=this.target.doc,n=[];k(t,r=>{var f,p,b;let s=new Map,o=new Map,i=this.target._start,c=null,l={},a="",h=0,d=0,u=()=>{if(c!==null){let g=null;switch(c){case"delete":d>0&&(g={delete:d}),d=0;break;case"insert":(typeof a=="object"||a.length>0)&&(g={insert:a},s.size>0&&(g.attributes={},s.forEach((x,O)=>{x!==null&&(g.attributes[O]=x)}))),a="";break;case"retain":h>0&&(g={retain:h},lo(l)||(g.attributes=io({},l))),h=0;break}g&&n.push(g),c=null}};for(;i!==null;){switch(i.content.constructor){case Z:case mt:this.adds(i)?this.deletes(i)||(u(),c="insert",a=i.content.getContent()[0],u()):this.deletes(i)?(c!=="delete"&&(u(),c="delete"),d+=1):i.deleted||(c!=="retain"&&(u(),c="retain"),h+=1);break;case et:this.adds(i)?this.deletes(i)||(c!=="insert"&&(u(),c="insert"),a+=i.content.str):this.deletes(i)?(c!=="delete"&&(u(),c="delete"),d+=i.length):i.deleted||(c!=="retain"&&(u(),c="retain"),h+=i.length);break;case C:{let{key:g,value:x}=i.content;if(this.adds(i)){if(!this.deletes(i)){let O=(f=s.get(g))!=null?f:null;St(O,x)?x!==null&&i.delete(r):(c==="retain"&&u(),St(x,(p=o.get(g))!=null?p:null)?delete l[g]:l[g]=x)}}else if(this.deletes(i)){o.set(g,x);let O=(b=s.get(g))!=null?b:null;St(O,x)||(c==="retain"&&u(),l[g]=O)}else if(!i.deleted){o.set(g,x);let O=l[g];O!==void 0&&(St(O,x)?O!==null&&i.delete(r):(c==="retain"&&u(),x===null?delete l[g]:l[g]=x))}i.deleted||(c==="insert"&&u(),De(s,i.content));break}}i=i.right}for(u();n.length>0;){let g=n[n.length-1];if(g.retain!==void 0&&g.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}},_e=class e extends U{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){var t;return(t=this.doc)!=null||M(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new e}clone(){let t=new e;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);let r=new Zn(this,t,n);lr(this,t,r),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){var r;(r=this.doc)!=null||M();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===et&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?k(this.doc,r=>{let s=new on(null,this._start,0,new Map);for(let o=0;o<t.length;o++){let i=t[o];if(i.insert!==void 0){let c=!n&&typeof i.insert=="string"&&o===t.length-1&&s.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof c!="string"||c.length>0)&&ss(r,this,s,c,i.attributes||{})}else i.retain!==void 0?Wo(r,this,s,i.retain,i.attributes||{}):i.delete!==void 0&&Zo(r,s,i.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){var d;(d=this.doc)!=null||M();let s=[],o=new Map,i=this.doc,c="",l=this._start;function a(){if(c.length>0){let u={},f=!1;o.forEach((b,g)=>{f=!0,u[g]=b});let p={insert:c};f&&(p.attributes=u),s.push(p),c=""}}let h=()=>{for(;l!==null;){if(bt(l,t)||n!==void 0&&bt(l,n))switch(l.content.constructor){case et:{let u=o.get("ychange");t!==void 0&&!bt(l,t)?(u===void 0||u.user!==l.id.client||u.type!=="removed")&&(a(),o.set("ychange",r?r("removed",l.id):{type:"removed"})):n!==void 0&&!bt(l,n)?(u===void 0||u.user!==l.id.client||u.type!=="added")&&(a(),o.set("ychange",r?r("added",l.id):{type:"added"})):u!==void 0&&(a(),o.delete("ychange")),c+=l.content.str;break}case Z:case mt:{a();let u={insert:l.content.getContent()[0]};if(o.size>0){let f={};u.attributes=f,o.forEach((p,b)=>{f[b]=p})}s.push(u);break}case C:bt(l,t)&&(a(),De(o,l.content));break}l=l.right}a()};return t||n?k(i,u=>{t&&ls(u,t),n&&ls(u,n),h()},"cleanup"):h(),s}insert(t,n,r){if(n.length<=0)return;let s=this.doc;s!==null?k(s,o=>{let i=jn(o,this,t,!r);r||(r={},i.currentAttributes.forEach((c,l)=>{r[l]=c})),ss(o,this,i,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r){let s=this.doc;s!==null?k(s,o=>{let i=jn(o,this,t,!r);ss(o,this,i,n,r||{})}):this._pending.push(()=>this.insertEmbed(t,n,r||{}))}delete(t,n){if(n===0)return;let r=this.doc;r!==null?k(r,s=>{Zo(s,jn(s,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;let s=this.doc;s!==null?k(s,o=>{let i=jn(o,this,t,!1);i.right!==null&&Wo(o,this,i,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?k(this.doc,n=>{Xn(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?k(this.doc,r=>{Cs(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return As(this,t)}getAttributes(){return Ii(this)}_write(t){t.writeTypeRef(Ya)}},Ca=e=>new _e,Ke=class{constructor(t,n=()=>!0){var r;this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,(r=t.doc)!=null||M()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===Gt||n.constructor===zt)&&n._start!==null)t=n._start;else for(;t!==null;){let r=t.next;if(r!==null){t=r;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}},zt=class e extends U{constructor(){super(),this._prelimContent=[]}get firstChild(){let t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new e}clone(){let t=new e;return t.insert(0,this.toArray().map(n=>n instanceof U?n.clone():n)),t}get length(){var t;return(t=this.doc)!=null||M(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Ke(this,t)}querySelector(t){t=t.toUpperCase();let r=new Ke(this,s=>s.nodeName&&s.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Q(new Ke(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){lr(this,t,new Qn(this,n,t))}toString(){return Ei(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){let s=t.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),sn(this,o=>{s.insertBefore(o.toDOM(t,n,r),null)}),s}insert(t,n){this.doc!==null?k(this.doc,r=>{Ai(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)k(this.doc,r=>{let s=t&&t instanceof U?t._item:t;Hn(r,this,s,n)});else{let r=this._prelimContent,s=t===null?0:r.findIndex(o=>o===t)+1;if(s===0&&t!==null)throw G("Reference item not found");r.splice(s,0,...n)}}delete(t,n=1){this.doc!==null?k(this.doc,r=>{Di(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return _i(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Ui(this,t)}slice(t=0,n=this.length){return Si(this,t,n)}forEach(t){sn(this,t)}_write(t){t.writeTypeRef(Ga)}},Aa=e=>new zt,Gt=class e extends zt{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new e(this.nodeName)}clone(){let t=new e(this.nodeName),n=this.getAttributes();return co(n,(r,s)=>{t.setAttribute(s,r)}),t.insert(0,this.toArray().map(r=>r instanceof U?r.clone():r)),t}toString(){let t=this.getAttributes(),n=[],r=[];for(let c in t)r.push(c);r.sort();let s=r.length;for(let c=0;c<s;c++){let l=r[c];n.push(l+'="'+t[l]+'"')}let o=this.nodeName.toLocaleLowerCase(),i=n.length>0?" "+n.join(" "):"";return`<${o}${i}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?k(this.doc,n=>{Xn(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?k(this.doc,r=>{Cs(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return As(this,t)}hasAttribute(t){return Ti(this,t)}getAttributes(t){return t?vi(this,t):Ii(this)}toDOM(t=document,n={},r){let s=t.createElement(this.nodeName),o=this.getAttributes();for(let i in o){let c=o[i];typeof c=="string"&&s.setAttribute(i,c)}return sn(this,i=>{s.appendChild(i.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(t){t.writeTypeRef(za),t.writeKey(this.nodeName)}},Da=e=>new Gt(e.readKey()),Qn=class extends qt{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},cn=class e extends Yt{constructor(t){super(),this.hookName=t}_copy(){return new e(this.hookName)}clone(){let t=new e(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){let s=n[this.hookName],o;return s!==void 0?o=s.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(t){t.writeTypeRef(Ja),t.writeKey(this.hookName)}},Ia=e=>new cn(e.readKey()),tr=class e extends _e{get nextSibling(){let t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){let t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new e}clone(){let t=new e;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){let s=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(t=>{let n=[];for(let s in t.attributes){let o=[];for(let i in t.attributes[s])o.push({key:i,value:t.attributes[s][i]});o.sort((i,c)=>i.key<c.key?-1:1),n.push({nodeName:s,attrs:o})}n.sort((s,o)=>s.nodeName<o.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){let o=n[s];r+=`<${o.nodeName}`;for(let i=0;i<o.attrs.length;i++){let c=o.attrs[i];r+=` ${c.key}="${c.value}"`}r+=">"}r+=t.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Ha)}},Ta=e=>new tr,Ee=class{constructor(t,n){this.id=t,this.length=n}get deleted(){throw J()}mergeWith(t){return!1}write(t,n,r){throw J()}integrate(t,n){throw J()}},va=0,$=class extends Ee{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),ci(t.doc.store,this)}write(t,n){t.writeInfo(va),t.writeLen(this.length-n)}getMissing(t,n){return null}},Jt=class e{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new e(this.content)}splice(t){throw J()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}},Va=e=>new Jt(e.readBuf()),Ue=class e{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new e(this.len)}splice(t){let n=new e(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){Ze(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}},Oa=e=>new Ue(e.readLen()),Ri=(e,t)=>new Et({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1}),Ht=class e{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;let n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new e(Ri(this.doc.guid,this.opts))}splice(t){throw J()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}},La=e=>new Ht(Ri(e.readString(),e.readAny())),mt=class e{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new e(this.embed)}splice(t){throw J()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}},Na=e=>new mt(e.readJSON()),C=class e{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new e(this.key,this.value)}splice(t){throw J()}mergeWith(t){return!1}integrate(t,n){let r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}},Ma=e=>new C(e.readKey(),e.readJSON()),ln=class e{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new e(this.arr)}splice(t){let n=new e(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let o=this.arr[s];t.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}},Ra=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++){let s=e.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new ln(n)},Ba=qe("node_env")==="development",Ct=class e{constructor(t){this.arr=t,Ba&&Nr(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new e(this.arr)}splice(t){let n=new e(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){let r=this.arr.length;t.writeLen(r-n);for(let s=n;s<r;s++){let o=this.arr[s];t.writeAny(o)}}getRef(){return 8}},$a=e=>{let t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new Ct(n)},et=class e{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new e(this.str)}splice(t){let n=new e(this.str.slice(t));this.str=this.str.slice(0,t);let r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",n.str="\uFFFD"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}},Fa=e=>new et(e.readString()),ja=[Sa,_a,Ca,Da,Aa,Ia,Ta],qa=0,Pa=1,Ya=2,za=3,Ga=4,Ja=5,Ha=6,Z=class e{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new e(this.type._copy())}splice(t){throw J()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(t.beforeState.get(r.id.client)||0)&&t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}},Xa=e=>new Z(ja[e.readTypeRef()](e)),fs=(e,t)=>{let n=t,r=0,s;do r>0&&(n=y(n.client,n.clock+r)),s=Rt(e,n),r=n.clock-s.id.clock,n=s.redone;while(n!==null&&s instanceof S);return{item:s,diff:r}},Ds=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},er=(e,t,n)=>{let{client:r,clock:s}=t.id,o=new S(y(r,s+n),t,y(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=y(t.redone.client,t.redone.clock+n)),t.right=o,o.right!==null&&(o.right.left=o),e._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=n,o},Qo=(e,t)=>ve(e,n=>Xt(n.deletions,t)),Bi=(e,t,n,r,s,o)=>{let i=e.doc,c=i.store,l=i.clientID,a=t.redone;if(a!==null)return B(e,a);let h=t.parent._item,d=null,u;if(h!==null&&h.deleted===!0){if(h.redone===null&&(!n.has(h)||Bi(e,h,n,r,s,o)===null))return null;for(;h.redone!==null;)h=B(e,h.redone)}let f=h===null?t.parent:h.content.type;if(t.parentSub===null){for(d=t.left,u=t;d!==null;){let x=d;for(;x!==null&&x.parent._item!==h;)x=x.redone===null?null:B(e,x.redone);if(x!==null&&x.parent._item===h){d=x;break}d=d.left}for(;u!==null;){let x=u;for(;x!==null&&x.parent._item!==h;)x=x.redone===null?null:B(e,x.redone);if(x!==null&&x.parent._item===h){u=x;break}u=u.right}}else if(u=null,t.right&&!s){for(d=t;d!==null&&d.right!==null&&(d.right.redone||Xt(r,d.right.id)||Qo(o.undoStack,d.right.id)||Qo(o.redoStack,d.right.id));)for(d=d.right;d.redone;)d=B(e,d.redone);if(d&&d.right!==null)return null}else d=f._map.get(t.parentSub)||null;let p=_(c,l),b=y(l,p),g=new S(b,d,d&&d.lastId,u,u&&u.id,f,t.parentSub,t.content.copy());return t.redone=b,Ds(g,!0),g.integrate(e,0),g},S=class e extends Ee{constructor(t,n,r,s,o,i,c,l){super(t,l.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=o,this.parent=i,this.parentSub=c,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(t){(this.info&8)>0!==t&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(t){this.keep!==t&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(t){this.deleted!==t&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=_(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=_(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===pt&&this.id.client!==this.parent.client&&this.parent.clock>=_(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=hs(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=B(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===$||this.right&&this.right.constructor===$)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===e?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===e&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===pt){let r=Rt(n,this.parent);r.constructor===$?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=hs(t,t.doc.store,y(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let o=new Set,i=new Set;for(;s!==null&&s!==this.right;){if(i.add(s),o.add(s),Mt(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,o.clear();else if(Mt(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&i.has(Rt(t.doc.store,s.origin)))o.has(Rt(t.doc.store,s.origin))||(r=s,o.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ci(t.doc.store,this),this.content.integrate(t,this),Go(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new $(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:y(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Mt(t.origin,this.lastId)&&this.right===t&&Mt(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){let n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){let n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Ze(t.deleteSet,this.id.client,this.id.clock,this.length),Go(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw v();this.content.gc(t),n?na(t,this,new $(this.id,this.length)):this.content=new Ue(this.length)}write(t,n){let r=n>0?y(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,o=this.parentSub,i=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(o===null?0:32);if(t.writeInfo(i),r!==null&&t.writeLeftID(r),s!==null&&t.writeRightID(s),r===null&&s===null){let c=this.parent;if(c._item!==void 0){let l=c._item;if(l===null){let a=ks(c);t.writeParentInfo(!0),t.writeString(a)}else t.writeParentInfo(!1),t.writeLeftID(l.id)}else c.constructor===String?(t.writeParentInfo(!0),t.writeString(c)):c.constructor===pt?(t.writeParentInfo(!1),t.writeLeftID(c)):v();o!==null&&t.writeString(o)}this.content.write(t,n)}},$i=(e,t)=>Ka[t&31](e),Ka=[()=>{v()},Oa,Ra,Va,Fa,Na,Ma,Xa,$a,La,()=>{v()}],Wa=10,N=class extends Ee{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){v()}write(t,n){t.writeInfo(Wa),m(t.restEncoder,this.length-n)}getMissing(t,n){return null}},Fi=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},ji="__ $YJS$ __";Fi[ji]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Fi[ji]=!0;var Hi=Dt(require("$:/plugins/tiddlywiki/codemirror-6/lib/codemirror-view.js"),1),ed=require("$:/plugins/tiddlywiki/codemirror-6/lib/codemirror-state.js");var ar=class e{constructor(t,n){this.yanchor=t,this.yhead=n}toJSON(){return{yanchor:sr(this.yanchor),yhead:sr(this.yhead)}}static fromJSON(t){return new e(wt(t.yanchor),wt(t.yhead))}};var Kt=Dt(require("$:/plugins/tiddlywiki/codemirror-6/lib/codemirror-state.js"),1),qi=Dt(require("$:/plugins/tiddlywiki/codemirror-6/lib/codemirror-view.js"),1);var hr=class{constructor(t,n){this.ytext=t,this.awareness=n,this.undoManager=new jt(t)}toYPos(t,n=0){return Ce(this.ytext,t,n)}fromYPos(t){let n=Ae(wt(t),this.ytext.doc);if(n==null||n.type!==this.ytext)throw new Error("[y-codemirror] The position you want to retrieve was created by a different document");return{pos:n.index,assoc:n.assoc}}toYRange(t){let n=t.assoc,r=this.toYPos(t.anchor,n),s=this.toYPos(t.head,n);return new ar(r,s)}fromYRange(t){let n=this.fromYPos(t.yanchor),r=this.fromYPos(t.yhead);return n.pos===r.pos?Kt.EditorSelection.cursor(r.pos,r.assoc):Kt.EditorSelection.range(n.pos,r.pos)}},Wt=Kt.Facet.define({combine(e){return e[e.length-1]}}),dr=Kt.Annotation.define(),Is=class{constructor(t){this.view=t,this.conf=t.state.facet(Wt),this._observer=(n,r)=>{if(r.origin!==this.conf){let s=n.delta,o=[],i=0;for(let c=0;c<s.length;c++){let l=s[c];l.insert!=null?o.push({from:i,to:i,insert:l.insert}):l.delete!=null?(o.push({from:i,to:i+l.delete,insert:""}),i+=l.delete):i+=l.retain}t.dispatch({changes:o,annotations:[dr.of(this.conf)]})}},this._ytext=this.conf.ytext,this._ytext.observe(this._observer)}update(t){if(!t.docChanged||t.transactions.length>0&&t.transactions[0].annotation(dr)===this.conf)return;let n=this.conf.ytext;n.doc.transact(()=>{let r=0;t.changes.iterChanges((s,o,i,c,l)=>{let a=l.sliceString(0,l.length,`
`);s!==o&&n.delete(s+r,o-s),a.length>0&&n.insert(s+r,a),r+=a.length-(o-s)})},this.conf)}destroy(){this._ytext.unobserve(this._observer)}},Pi=qi.ViewPlugin.fromClass(Is);var X=Dt(require("$:/plugins/tiddlywiki/codemirror-6/lib/codemirror-view.js"),1),ur=Dt(require("$:/plugins/tiddlywiki/codemirror-6/lib/codemirror-state.js"),1);var Yi=X.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),Za=ur.Annotation.define(),Ts=class extends X.WidgetType{constructor(t,n){super(),this.color=t,this.name=n}toDOM(){return Ge("span",[j("class","cm-ySelectionCaret"),j("style",`background-color: ${this.color}; border-color: ${this.color}`)],[xe("\u2060"),Ge("div",[j("class","cm-ySelectionCaretDot")]),xe("\u2060"),Ge("div",[j("class","cm-ySelectionInfo")],[xe(this.name)]),xe("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},vs=class{constructor(t){this.conf=t.state.facet(Wt),this._listener=({added:n,updated:r,removed:s},o,i)=>{n.concat(r).concat(s).findIndex(l=>l!==this.conf.awareness.doc.clientID)>=0&&t.dispatch({annotations:[Za.of([])]})},this._awareness=this.conf.awareness,this._awareness.on("change",this._listener),this.decorations=ur.RangeSet.of([])}destroy(){this._awareness.off("change",this._listener)}update(t){let n=this.conf.ytext,r=n.doc,s=this.conf.awareness,o=[],i=this.conf.awareness.getLocalState();if(i!=null){let c=t.view.hasFocus&&t.view.dom.ownerDocument.hasFocus(),l=c?t.state.selection.main:null,a=i.cursor==null?null:wt(i.cursor.anchor),h=i.cursor==null?null:wt(i.cursor.head);if(l!=null){let d=Ce(n,l.anchor),u=Ce(n,l.head);(i.cursor==null||!or(a,d)||!or(h,u))&&s.setLocalStateField("cursor",{anchor:d,head:u})}else i.cursor!=null&&c&&s.setLocalStateField("cursor",null)}s.getStates().forEach((c,l)=>{if(l===s.doc.clientID)return;let a=c.cursor;if(a==null||a.anchor==null||a.head==null)return;let h=Ae(a.anchor,r),d=Ae(a.head,r);if(h==null||d==null||h.type!==n||d.type!==n)return;let{color:u="#30bced",name:f="Anonymous"}=c.user||{},p=c.user&&c.user.colorLight||u+"33",b=te(h.index,d.index),g=tt(h.index,d.index),x=t.view.state.doc.lineAt(b),O=t.view.state.doc.lineAt(g);if(x.number===O.number)o.push({from:b,to:g,value:X.Decoration.mark({attributes:{style:`background-color: ${p}`},class:"cm-ySelection"})});else{o.push({from:b,to:x.from+x.length,value:X.Decoration.mark({attributes:{style:`background-color: ${p}`},class:"cm-ySelection"})}),o.push({from:O.from,to:g,value:X.Decoration.mark({attributes:{style:`background-color: ${p}`},class:"cm-ySelection"})});for(let Zt=x.number+1;Zt<O.number;Zt++){let Rs=t.view.state.doc.line(Zt).from;o.push({from:Rs,to:Rs,value:X.Decoration.line({attributes:{style:`background-color: ${p}`,class:"cm-yLineSelection"}})})}}o.push({from:d.index,to:d.index,value:X.Decoration.widget({side:d.index-h.index>0?-1:1,block:!1,widget:new Ts(u,f)})})}),this.decorations=X.Decoration.set(o,!0)}},zi=X.ViewPlugin.fromClass(vs,{decorations:e=>e.decorations});var gr=Dt(require("$:/plugins/tiddlywiki/codemirror-6/lib/codemirror-state.js"),1),mr=Dt(require("$:/plugins/tiddlywiki/codemirror-6/lib/codemirror-view.js"),1);var Gi=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else n!==void 0&&n()}};var fr=class{constructor(t){this.undoManager=t}addTrackedOrigin(t){this.undoManager.addTrackedOrigin(t)}removeTrackedOrigin(t){this.undoManager.removeTrackedOrigin(t)}undo(){return this.undoManager.undo()!=null}redo(){return this.undoManager.redo()!=null}},hn=gr.Facet.define({combine(e){return e[e.length-1]}}),Qh=gr.Annotation.define(),Vs=class{constructor(t){this.view=t,this.conf=t.state.facet(hn),this._undoManager=this.conf.undoManager,this.syncConf=t.state.facet(Wt),this._beforeChangeSelection=null,this._mux=Gi(),this._onStackItemAdded=({stackItem:n,changedParentTypes:r})=>{r.has(this.syncConf.ytext)&&this._beforeChangeSelection&&!n.meta.has(this)&&n.meta.set(this,this._beforeChangeSelection)},this._onStackItemPopped=({stackItem:n})=>{let r=n.meta.get(this);if(r){let s=this.syncConf.fromYRange(r);t.dispatch(t.state.update({selection:s,effects:[mr.EditorView.scrollIntoView(s)]})),this._storeSelection()}},this._storeSelection=()=>{this._beforeChangeSelection=this.syncConf.toYRange(this.view.state.selection.main)},this._undoManager.on("stack-item-added",this._onStackItemAdded),this._undoManager.on("stack-item-popped",this._onStackItemPopped),this._undoManager.addTrackedOrigin(this.syncConf)}update(t){t.selectionSet&&(t.transactions.length===0||t.transactions[0].annotation(dr)!==this.syncConf)&&this._storeSelection()}destroy(){this._undoManager.off("stack-item-added",this._onStackItemAdded),this._undoManager.off("stack-item-popped",this._onStackItemPopped),this._undoManager.removeTrackedOrigin(this.syncConf)}},Ji=mr.ViewPlugin.fromClass(Vs),Os=({state:e,dispatch:t})=>e.facet(hn).undo()||!0,pr=({state:e,dispatch:t})=>e.facet(hn).redo()||!0;var Ls=[{key:"Mod-z",run:Os,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:pr,preventDefault:!0},{key:"Mod-Shift-z",run:pr,preventDefault:!0}];var Xi=(e,t,{undoManager:n=new jt(e)}={})=>{let r=new hr(e,t),s=[Wt.of(r),Pi];return t&&s.push(Yi,zi),n!==!1&&s.push(hn.of(new fr(n)),Ji,Hi.EditorView.domEventHandlers({beforeinput(o,i){return o.inputType==="historyUndo"?Os(i):o.inputType==="historyRedo"?pr(i):!1}})),s};var Ns=3e4,wr=class extends gn{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let n=ft();this.getLocalState()!==null&&Ns/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((s,o)=>{o!==this.clientID&&Ns<=n-s.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&Ms(this,r,"timeout")},L(Ns/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){let n=this.clientID,r=this.meta.get(n),s=r===void 0?0:r.clock+1,o=this.states.get(n);t===null?this.states.delete(n):this.states.set(n,t),this.meta.set(n,{clock:s,lastUpdated:ft()});let i=[],c=[],l=[],a=[];t===null?a.push(n):o==null?t!=null&&i.push(n):(c.push(n),xt(o,t)||l.push(n)),(i.length>0||l.length>0||a.length>0)&&this.emit("change",[{added:i,updated:l,removed:a},"local"]),this.emit("update",[{added:i,updated:c,removed:a},"local"])}setLocalStateField(t,n){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[t]:n})}getStates(){return this.states}},Ms=(e,t,n)=>{let r=[];for(let s=0;s<t.length;s++){let o=t[s];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){let i=e.meta.get(o);e.meta.set(o,{clock:i.clock+1,lastUpdated:ft()})}r.push(o)}}r.length>0&&(e.emit("change",[{added:[],updated:[],removed:r},n]),e.emit("update",[{added:[],updated:[],removed:r},n]))},Ki=(e,t,n=e.states)=>{let r=t.length,s=ut();m(s,r);for(let o=0;o<r;o++){let i=t[o],c=n.get(i)||null,l=e.meta.get(i).clock;m(s,i),m(s,l),rt(s,JSON.stringify(c))}return F(s)};var Wi=(e,t,n)=>{let r=D(t),s=ft(),o=[],i=[],c=[],l=[],a=w(r);for(let h=0;h<a;h++){let d=w(r),u=w(r),f=JSON.parse(st(r)),p=e.meta.get(d),b=e.states.get(d),g=p===void 0?0:p.clock;(g<u||g===u&&f===null&&e.states.has(d))&&(f===null?d===e.clientID&&e.getLocalState()!=null?u++:e.states.delete(d):e.states.set(d,f),e.meta.set(d,{clock:u,lastUpdated:s}),p===void 0&&f!==null?o.push(d):p!==void 0&&f===null?l.push(d):f!==null&&(xt(f,b)||c.push(d),i.push(d)))}(o.length>0||c.length>0||l.length>0)&&e.emit("change",[{added:o,updated:c,removed:l},n]),(o.length>0||i.length>0||l.length>0)&&e.emit("update",[{added:o,updated:i,removed:l},n])};
